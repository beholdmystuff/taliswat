<html>
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
body
{
    margin: 0;
    overflow: hidden;
    width: 100vw;
    height: 100vh;
}
#gameContainer
{
    margin: 0;
    overflow: hidden;
    width: 100vw;
    height: 100vh;
    background-color: black;
}
.hidden
{
    display: none;
}
/* MAIN MENU */
.mainMenu
{
    width: 100%;
    height: 100%;
}
.logo
{
    width: 30vw;
    height: 15vw;
    left: 35vw;
    position: absolute;
    background-image: url(assets/ui/logo.png);
    background-size: 100% 100%;
    animation: logoSkew 15s infinite;
    animation-timing-function: ease-in-out;
}
@keyframes logoSkew
{
    0% { transform: skew(0deg); }
    25% { transform: skew(5deg); }
    75% { transform: skew(-5deg); }
    100% { transform: skew(0deg); }
}

@font-face
{
  font-family: Caxton;
  src: url(assets/fonts/CaxtonStd-Book.otf);
}

@font-face
{
  font-family: Windlass;
  src: url(assets/fonts/Windlass.ttf);
}

.gameList
{
    width: 60vw;
    left: 20vw;
    position: absolute;
    height: 25vw;
    top: 17.5vw;
    overflow-x: hidden;
    overflow-y: auto;
    user-select: none;
}
.loadGame, .openGame
{
    display: inline-block;
    font-family: Windlass;
    border-radius: 1vw;
    border: 0px;
    margin: 0.5vw 0vw 0.5vw 0vw;
    line-height: 2vw;
    cursor: pointer;
    width: 98%;
    font-size: 1vw;
}
.loadGame:hover
{
    animation: openGameHover 3s infinite;
}
@keyframes openGameHover
{
    0% { background-color: #3ed33e99; }
    50% { background-color: #3ed33ecc; }
    100% { background-color: #3ed33e99; }
}
.openGame:hover
{
    animation: savedGameHover 3s infinite;
}
@keyframes savedGameHover
{
    0% { background-color: #64d5f299; }
    50% { background-color: #64d5f2cc; }
    100% { background-color: #64d5f299; }
}
.loadGame
{
    background-color: #3ed33e99;
}
.openGame
{
    background-color: #64d5f299;
}
.loadGame div, .openGame div
{
    display: inline-block;
    text-align: center;
    pointer-events: none;
    user-select: none;
}
.gameTypeIcon
{
    width: 5%;
}
.gameOwner
{
    width: 30%;
}
.gameSlots
{
    width: 35%;
}
.gameStatus
{
    width: 30%;
}

/* GAME LOBBY */
.gameLobby
{

}
.gameSlotsContainer
{
    user-select: none;
    width: 60vw;
    left: 20vw;
    position: absolute;
    height: 25vw;
    top: 17.5vw;
}
.gameSlot
{
    display: inline-block;
    font-family: Windlass;
    border-radius: 1vw;
    border: 0px;
    margin: 0.25vw 0vw 0.25vw 0vw;
    line-height: 3vw;
    width: 98%;
    font-size: 1vw;
    background: #c0c0c099;
    z-index: 5;
    transition: background-color 0.25s linear;
    height: 3vw;
}
.gameSlot:hover
{
    background-color: #c0c0c0cc;
}
.gameSlot div, .gameSlot div
{
    display: block;
    text-align: center;
}
.slotPlayerName
{
    position: absolute;
    left: 0%;
    pointer-events: none;
    width: 40%;
}
.slotCharPic
{
    position: absolute;
    left: 40%;
    background-size: 22.5% 100%;
    background-repeat: no-repeat;
    background-position: center;
    width: 25%;
    min-height: 3vw;
}
.clickable
{
    cursor: pointer;
}
.slotCharName
{
    position: absolute;
    left: 65%;
    pointer-events: none;
    width: 25%;
}
.readyButton
{
    min-width: 5%;
    min-height: 3vw;
    background-size: 100% 100%;
    width: 5%;
    left: 92.5%;
    position: absolute;
}
.readyIcon
{
    background-size: 100% 100%;
    width: 100%;
    height: 100%;
}

/* CHARACTER SELECTOR */
.characterSelector
{
    width: 100vw;
    height: 100vw;
    position: absolute;
    background-color: black;
    z-index: 4;
    top: 0;
    left: 0;
}

.characterPicker
{
    width: 100vw;
    height: 17vw;
    overflow-x: scroll;
    overflow-y: hidden;
    white-space: nowrap;
    top:  8vw;
    position: absolute;
}
.nameSearchInput
{
    position: absolute;
    left: 42.5vw;
    top: 3vw;
    width: 15vw;
    font-family: Windlass;
    font-size: 1.2vw;
    line-height: 2vw;
    background-color: transparent;
    border: 0px;
    outline: none;
    background-image: url(assets/ui/paper_title.png);
    background-size: 100% 100%;
    text-align: center;
}
.nameSearchLabel
{
    position: absolute;
    left: 26.5vw;
    top: 3.2vw;
    width: 16vw;
    color: white;
    font-family: Windlass;
    font-size: 1.2vw;
    line-height: 2vw;
    user-select: none;
}

.charSelectorCharContainer
{
    display: inline-block;
    width: 10vw;
    height: 15vw;
    margin: 0vw 1vw 0vw 1vw;
    padding: 0.5vw 1vw 1vw 1vw;
    transition: background-color 0.3s ease-out, opacity 0.2s linear;
    border-radius: 2vw;
    cursor: pointer;
    background-size: 100% 100%;
    opacity: 1;
    user-select: none;
}
.charSelectorCharContainer:hover
{
    background-color: #64d5f299;
}
.characterSelectorMini
{
    width: inherit;
    height: inherit;
    pointer-events: none;
}
.characterSelectorName
{
    width: 13vw;
    height: 2vw;
    position: relative;
    left: -1.5vw;
    font-family: Windlass;
    font-size: 1.2vw;
    line-height: 2vw;
    background-image: url(assets/ui/paper_title.png);
    background-size: 100% 100%;
    text-align: center;
    pointer-events: none;
}
.characterSelectorDescription
{
    top: 25.5vw;
    left: 30vw;
    width: 40vw;
    height: 20vw;
    text-align: center;
    pointer-events: none;
    background-image: url(assets/ui/paper.png);
    background-size: 100% 100%;
    z-index: 5;
    position: absolute;
    font-family: Caxton;
    font-size: 0.8vw;
    line-height: 1vw;
    white-space: pre-wrap;
    padding: 1vw 2vw 0vw 2vw;
    user-select: none;
}
.characterStatFilter
{

}
.letMeOutButton
{
    position: absolute;
    top: -4vw;
    left: 48vw;
    width: 9vw;
    font-family: Windlass;
    font-size: 1vw;
    line-height: 2vw;
    border-radius: 3vw;
    background-color: #c0c0c099;
    padding: 0.5vw 0.5vw 0.5vw 1vw;
    cursor: pointer;
}
.letMeOutButton:before
{
    position: absolute;
    top: 0vw;
    right: 0vw;
    display: block;
    content: " ";
    width: 3vw;
    height: 3vw;
    background-image: url(assets/ui/let_me_out_button.png);
    background-size: 100% 100%;
    background-position: right;
    background-repeat: no-repeat;
}
/* CONTAINERS */
#gameMap
{
    overflow: hidden;
    width: 100vw;
    height: 100vh;
    background-image: url(bg.jpg);
    background-size: 100% 100%;
}
#gameMapInner div
{
    position: absolute;
    outline: none;
    border: 0px;
}
#gameMapInner
{
    width: 6353px;
    height: 3792px;
    cursor: grab;
    user-select: none;
    transform-origin: center;
}
/* BOARD MAPS*/
.boardBase
{
    width: 4096px;
    height: 2048px;
    top: 885px;
    left: 1114px;
    z-index: 2;
    background-size: 100% 100%;
}
.boardExpansion
{
    width: 2560px;
    height: 1792px;
    z-index: 1;
    background-size: 100% 100%;
    position: absolute;
}
.boardWoodland
{
    top: 1990px;
    left: 3790px;
}
.boardCity
{
    top: 0px;
    left: 0px;
}
.boardDungeon
{
    top: 0px;
    left: 3790px;
}
.boardhighland
{
    top: 1990px;
    left: 0px;
}
/* BASE BOARD SPACES */
.space
{
    position: absolute;
    opacity: 0.0;
    cursor: pointer;
    transition: opacity 0.3s ease-in-out;
    animation: fadeOut 0.5s;
}
.space:hover
{
    opacity: 0.5;
    animation: fadeIn 1s infinite;
}
@keyframes fadeIn
{
    0% {opacity: 0.5}
    50% {opacity: 0.75}
    100% {opacity: 0.5}
}
@keyframes fadeOut
{
    0% {opacity: 0.5}
    100% {opacity: 0.0}
}

.charCard
{
    width: 1230px;
    height: 815px;
    top: 2048px;
    left: 1446px;
    background-size: 100% 100%;
}

/* OUTER RING */
.citySpace
{
    width: 555px;
    height: 300px;
    top: 33px;
    left: 44px;
}
.fields1Space
{
    width: 585px;
    height: 300px;
    top: 33px;
    left: 595px;
}
.hills1Space
{
    width: 577px;
    height: 300px;
    top: 33px;
    left: 1178px;
}
.plains1Space
{
    width: 577px;
    height: 300px;
    top: 33px;
    left: 1754px;
}
.woods1Space
{
    width: 570px;
    height: 300px;
    top: 33px;
    left: 2331px;
}
.plains2Space
{
    width: 585px;
    height: 300px;
    top: 33px;
    left: 2901px;
}
.tavernSpace
{
    width: 570px;
    height: 315px;
    top: 33px;
    left: 3486px;
}
.fields2Space
{
    width: 450px;
    height: 288px;
    top: 348px;
    left: 3605px;
}
.ruinsSpace
{
    width: 450px;
    height: 272px;
    top: 634px;
    left: 3605px;
}
.plains3Space
{
    width: 450px;
    height: 272px;
    top: 906px;
    left: 3605px;
}
.forest3Space
{
    width: 450px;
    height: 272px;
    top: 1178px;
    left: 3605px;
}
.fields3Space
{
    width: 450px;
    height: 272px;
    top: 1450px;
    left: 3605px;
}
.villageSpace
{
    width: 568px;
    height: 280px;
    top: 1735px;
    left: 3485px;
}
.fields4Space
{
    width: 586px;
    height: 280px;
    top: 1735px;
    left: 2901px;
}
.graveyardSpace
{
    width: 575px;
    height: 280px;
    top: 1735px;
    left: 2328px;
}
.woods2Space
{
    width: 575px;
    height: 280px;
    top: 1735px;
    left: 1756px;
}
.sentinelSpace
{
    width: 575px;
    height: 280px;
    top: 1735px;
    left: 1181px;
}
.hills2Space
{
    width: 585px;
    height: 280px;
    top: 1735px;
    left: 598px;
}
.chapelSpace
{
    width: 555px;
    height: 280px;
    top: 1735px;
    left: 45px;
}
.fields5Space
{
    width: 405px;
    height: 285px;
    top: 1450px;
    left: 45px;
}
.cragsSpace
{
    width: 405px;
    height: 272px;
    top: 1179px;
    left: 45px;
}
.plains4Space
{
    width: 405px;
    height: 290px;
    top: 890px;
    left: 45px;
}
.woods3Space
{
    width: 405px;
    height: 260px;
    top: 630px;
    left: 45px;
}
.fields6Space
{
    width: 405px;
    height: 260px;
    top: 380px;
    left: 45px;
}
/* MIDDLE RING */
.warlocksCaveSpace
{
    width: 618px;
    height: 291px;
    top: 356px;
    left: 448px;
}
.desert1Space
{
    width: 645px;
    height: 291px;
    top: 356px;
    left: 1066px;
}
.oasisSpace
{
    width: 675px;
    height: 291px;
    top: 356px;
    left: 1710px;
}
.desert2Space
{
    width: 645px;
    height: 291px;
    top: 356px;
    left: 2380px;
}
.templeSpace
{
    width: 580px;
    height: 291px;
    top: 356px;
    left: 3022px;
}
.woodsSpace
{
    width: 410px;
    height: 250px;
    top: 650px;
    left: 3205px;
}
.runesSpace
{
    width: 410px;
    height: 280px;
    top: 900px;
    left: 3205px;
}
.castleSpace
{
    width: 410px;
    height: 270px;
    top: 1180px;
    left: 3205px;
}
.portalOfPowerSpace
{
    width: 590px;
    height: 270px;
    top: 1445px;
    left: 3025px;
}
.blackKnightSpace
{
    width: 640px;
    height: 270px;
    top: 1445px;
    left: 2385px;
}
.hiddenValleySpace
{
    width: 675px;
    height: 270px;
    top: 1445px;
    left: 1710px;
}
.hillsSpace
{
    width: 645px;
    height: 270px;
    top: 1445px;
    left: 1065px;
}
.cursedGladeSpace
{
    width: 625px;
    height: 270px;
    top: 1445px;
    left: 445px;
}
.runes2Space
{
    width: 425px;
    height: 270px;
    top: 1180px;
    left: 445px;
}
.chasmSpace
{
    width: 425px;
    height: 270px;
    top: 910px;
    left: 445px;
}
.runes3Space
{
    width: 425px;
    height: 270px;
    top: 650px;
    left: 445px;
}

/* INNER RING */

.valleyOfFireSpace
{
    width: 765px;
    height: 250px;
    top: 650px;
    left: 895px;
}
.werewolfDenSpace
{
    width: 785px;
    height: 250px;
    top: 650px;
    left: 1660px;
}
.deathSpace
{
    width: 755px;
    height: 250px;
    top: 650px;
    left: 2445px;
}
.cryptSpace
{
    width: 410px;
    height: 280px;
    top: 900px;
    left: 2790px;
}
.plainOfPerilSpace
{
    width: 760px;
    height: 245px;
    top: 1180px;
    left: 2440px;
}
.minesSpace
{
    width: 785px;
    height: 245px;
    top: 1180px;
    left: 1660px;
}
.vampiresTowerSpace
{
    width: 765px;
    height: 245px;
    top: 1180px;
    left: 895px;
}
.pitsSpace
{
    width: 350px;
    height: 280px;
    top: 900px;
    left: 895px;
}
.crownOfCommandSpace
{
    width: 1550px;
    height: 280px;
    top: 900px;
    left: 1240px;
}

/* CITY BOARD */
.cityGateSpace
{
     width: 405px;
    height: 330px;
       top: 574px;
      left: 725px;
}
.citySquareOfKingsSpace
{
     width: 400px;
    height: 235px;
       top: 930px;
      left: 705px;
}
.cityRoyalLaneSpace
{
     width: 400px;
    height: 230px;
       top: 1165px;
      left: 705px;
}
.citySouthSideAlleySpace
{
     width: 400px;
    height: 360px;
       top: 1390px;
      left: 705px;
}
.citySanctuarySquareSpace
{
     width: 280px;
    height: 360px;
       top: 1390px;
      left: 425px;
}
.citySanctuarySquareSpace
{
     width: 280px;
    height: 360px;
       top: 1390px;
      left: 425px;
}
.cityHighTempleSpace
{
     width: 375px;
    height: 360px;
       top: 1390px;
      left: 50px;
}
.cityNobleStreetSpace
{
     width: 280px;
    height: 225px;
       top: 1170px;
      left: 425px;
}
.cityAcademySpace
{
     width: 375px;
    height: 225px;
       top: 1170px;
      left: 50px;
}
.cityFlaskStreetSpace
{
     width: 280px;
    height: 230px;
       top: 935px;
      left: 425px;
}
.cityApothecarySpace
{
     width: 375px;
    height: 225px;
       top: 940px;
      left: 50px;
}
.citySorcererSquareSpace
{
     width: 280px;
    height: 265px;
       top: 665px;
      left: 425px;
}
.cityElementalAvenueSpace
{
     width: 280px;
    height: 265px;
       top: 665px;
      left: 425px;
}
.citySorcererSquareSpace
{
     width: 380px;
    height: 265px;
       top: 665px;
      left: 50px;
}
.cityTownSquareSpace
{
     width: 370px;
    height: 315px;
       top: 345px;
      left: 425px;
}
.cityMagicEmporiumSpace
{
     width: 370px;
    height: 265px;
       top: 400px;
      left: 50px;
}
.cityJailSpace
{
     width: 410px;
    height: 360px;
       top: 45px;
      left: 50px;
}
.citySoothsayerSpace
{
     width: 335px;
    height: 300px;
       top: 45px;
      left: 460px;
}
.cityGuildStreetSpace
{
     width: 305px;
    height: 215px;
       top: 345px;
      left: 795px;
}
.cityArmourySpace
{
     width: 305px;
    height: 300px;
       top: 45px;
      left: 795px;
}
.cityRatsRoadSpace
{
     width: 315px;
    height: 215px;
       top: 345px;
      left: 1100px;
}
.cityMenagerieSpace
{
     width: 315px;
    height: 300px;
       top: 45px;
      left: 1100px;
}
.cityDroppingsLaneSpace
{
     width: 290px;
    height: 215px;
       top: 345px;
      left: 1415px;
}
.cityStablesSpace
{
     width: 290px;
    height: 300px;
       top: 45px;
      left: 1415px;
}
.cityStablesSpace
{
     width: 290px;
    height: 300px;
       top: 45px;
      left: 1415px;
}
.cityBeggarsRowSpace
{
     width: 300px;
    height: 215px;
       top: 345px;
      left: 1710px;
}
.cityWharfSpace
{
     width: 300px;
    height: 300px;
       top: 45px;
      left: 1710px;
}
.cityThievesAlleySpace
{
     width: 495px;
    height: 215px;
       top: 345px;
      left: 2010px;
}
.cityRoguesGuildSpace
{
     width: 495px;
    height: 300px;
       top: 45px;
      left: 2010px;
}
.cityNorthSideAlleySpace
{
     width: 495px;
    height: 320px;
       top: 560px;
      left: 2010px;
}
.cityCobbleLaneSpace
{
     width: 300px;
    height: 320px;
       top: 560px;
      left: 1710px;
}
.cityGoldStreetSpace
{
     width: 290px;
    height: 320px;
       top: 560px;
      left: 1415px;
}
.citySpeakersCornerSpace
{
     width: 270px;
    height: 320px;
       top: 560px;
      left: 1145px;
}

/* DUNGEON BOARD */
.dungeonEntranceSpace
{
     width: 360px;
    height: 260px;
       top: 1490px;
      left: 1425px;
}
.dungeonCorridor1Space
{
     width: 360px;
    height: 270px;
       top: 1220px;
      left: 1425px;
}
.dungeonTunnel1Space
{
     width: 360px;
    height: 270px;
       top: 950px;
      left: 1425px;
}
.dungeonLibrarySpace
{
     width: 365px;
    height: 340px;
       top: 605px;
      left: 1420px;
}
.dungeonCavern1Space
{
     width: 340px;
    height: 275px;
       top: 605px;
      left: 1075px;
}
.dungeonCorridor2Space
{
     width: 340px;
    height: 275px;
       top: 605px;
      left: 735px;
}
.dungeonGuardRoomSpace
{
     width: 340px;
    height: 275px;
       top: 605px;
      left: 390px;
}
.dungeonTunnel2Space
{
     width: 335px;
    height: 275px;
       top: 605px;
      left: 55px;
}
.dungeonCavern2Space
{
     width: 335px;
    height: 245px;
       top: 355px;
      left: 55px;
}
.dungeonCorridor3Space
{
     width: 340px;
    height: 245px;
       top: 355px;
      left: 390px;
}
.dungeonCellSpace
{
     width: 340px;
    height: 245px;
       top: 355px;
      left: 735px;
}
.dungeonTunnel3Space
{
     width: 340px;
    height: 245px;
       top: 355px;
      left: 1080px;
}
.dungeonVault1Space
{
     width: 305px;
    height: 245px;
       top: 355px;
      left: 1420px;
}
.dungeonHallOfDarknessSpace
{
     width: 375px;
    height: 320px;
       top: 355px;
      left: 1725px;
}
.dungeonHallOfDarknessSpace
{
     width: 375px;
    height: 320px;
       top: 355px;
      left: 1725px;
}
.dungeonTunnel4Space
{
     width: 315px;
    height: 270px;
       top: 675px;
      left: 1785px;
}
.dungeonCorridor4Space
{
     width: 315px;
    height: 270px;
       top: 950px;
      left: 1785px;
}
.dungeonKitchenSpace
{
     width: 315px;
    height: 270px;
       top: 1220px;
      left: 1785px;
}
.dungeonCavern3Space
{
     width: 315px;
    height: 260px;
       top: 1490px;
      left: 1785px;
}
.dungeonCorridor5Space
{
     width: 405px;
    height: 260px;
       top: 1490px;
      left: 2100px;
}
.dungeonTunnel5Space
{
     width: 405px;
    height: 270px;
       top: 1220px;
      left: 2100px;
}
.dungeonTortureChamberSpace
{
     width: 405px;
    height: 270px;
       top: 950px;
      left: 2100px;
}
.dungeonVault2Space
{
     width: 405px;
    height: 270px;
       top: 680px;
      left: 2100px;
}
.dungeonCorridor6Space
{
     width: 405px;
    height: 255px;
       top: 420px;
      left: 2100px;
}
.dungeonMonsterPitSpace
{
     width: 455px;
    height: 375px;
       top: 45px;
      left: 2050px;
}
.dungeonTunnel6Space
{
     width: 325px;
    height: 310px;
       top: 45px;
      left: 1725px;
}
.dungeonCavern4Space
{
     width: 305px;
    height: 310px;
       top: 45px;
      left: 1420px;
}
.dungeonSummoningCircleSpace
{
     width: 485px;
    height: 310px;
       top: 45px;
      left: 930px;
}
.dungeonVault3Space
{
     width: 345px;
    height: 310px;
       top: 45px;
      left: 580px;
}
.dungeonTresureChamberSpace
{
     width: 520px;
    height: 310px;
       top: 45px;
      left: 60px;
}

/* WOODLAND BOARD */
.woodlandEntranceSpace
{
     width: 370px;
    height: 295px;
       top: 35px;
      left: 1420px;
}
.woodlandWoods1Space
{
     width: 370px;
    height: 265px;
       top: 335px;
      left: 1420px;
}
.woodlandGlade1Space
{
     width: 370px;
    height: 265px;
       top: 595px;
     left: 1420px;
}
.woodlandFaerieRingSpace
{
     width: 370px;
    height: 340px;
       top: 864px;
      left: 1420px;
}
.woodlandThicket1Space
{
    width: 315px;
    height: 260px;
    top: 945px;
    left: 1105px;
}
.woodlandWoods2Space
{
    width: 335px;
    height: 260px;
    top: 945px;
    left: 770px;
}
.woodlandWitchTreeSpace
{
    width: 335px;
    height: 260px;
    top: 945px;
    left: 432px;
}
.woodlandGlade2Space
{
    width: 380px;
    height: 260px;
    top: 945px;
    left: 50px;
}
.woodlandThicket2Space
{
    width: 380px;
    height: 240px;
    top: 1205px;
    left: 50px;
}
.woodlandWoods3Space
{
    width: 340px;
    height: 240px;
    top: 1205px;
    left: 430px;
}
.woodlandCrossroadsSpace
{
    width: 335px;
    height: 240px;
    top: 1205px;
    left: 770px;
}
.woodlandGlade3Space
{
    width: 335px;
    height: 240px;
    top: 1205px;
    left: 1105px;
}
.woodlandDenseForestSpace
{
    width: 300px;
    height: 240px;
    top: 1205px;
    left: 1440px;
}
.woodlandSwamplandSpace
{
    width: 365px;
    height: 315px;
    top: 1130px;
    left: 1740px;
}
.woodlandGlade4Space
{
    width: 305px;
    height: 265px;
    top: 865px;
    left: 1800px;
}
.woodlandWoods4Space
{
    width: 305px;
    height: 265px;
    top: 595px;
    left: 1800px;
}
.woodlandBog1Space
{
    width: 305px;
    height: 265px;
    top: 330px;
    left: 1800px;
}
.woodlandThicket3Space
{
    width: 305px;
    height: 295px;
    top: 35px;
    left: 1800px;
}
.woodlandFaerieVillage1Space
{
    width: 405px;
    height: 295px;
    top: 35px;
    left: 2110px;
}
.woodlandGlade5Space
{
    width: 405px;
    height: 260px;
    top: 335px;
    left: 2110px;
}
.woodlandBlastedHeathSpace
{
    width: 405px;
    height: 260px;
    top: 600px;
    left: 2110px;
}
.woodlandDenseForest1Space
{
    width: 405px;
    height: 260px;
    top: 865px;
    left: 2110px;
}
.woodlandFaerieVillage2Space
{
    width: 405px;
    height: 250px;
    top: 1130px;
    left: 2110px;
}
.woodlandMysticGlenSpace
{
    width: 450px;
    height: 370px;
    top: 1385px;
    left: 2065px;
}
.woodlandMysticGlenSpace
{
    width: 450px;
    height: 370px;
    top: 1385px;
    left: 2065px;
}
.woodlandBog2Space
{
    width: 320px;
    height: 310px;
    top: 1445px;
    left: 1740px;
}
.woodlandThicket4Space
{
    width: 300px;
    height: 310px;
    top: 1445px;
    left: 1440px;
}
.woodlandMabsLairSpace
{
    width: 480px;
    height: 310px;
    top: 1445px;
    left: 960px;
}
.woodlandDenseForest2Space
{
    width: 340px;
    height: 310px;
    top: 1445px;
    left: 620px;
}
.woodlandMeetingWithDestinySpace
{
    width: 570px;
    height: 310px;
    top: 1445px;
    left: 50px;
}



/* HIGHLAND BOARD */
.highlandEntranceSpace
{
     width: 300px;
    height: 300px;
       top: 45px;
      left: 815px;
}
.highlandHills1Space
{
     width: 300px;
    height: 265px;
       top: 345px;
      left: 815px;
}
.highlandCliff1Space
{
     width: 300px;
    height: 265px;
       top: 605px;
      left: 815px;
}
.highlandRidgewaySpace
{
     width: 300px;
    height: 330px;
       top: 870px;
      left: 815px;
}
.highlandRavine1Space
{
     width: 325px;
    height: 255px;
       top: 945px;
      left: 1115px;
}
.highlandHills2Space
{
     width: 330px;
    height: 255px;
       top: 945px;
      left: 1440px;
}
.highlandRuinedMineSpace
{
     width: 330px;
    height: 255px;
       top: 945px;
      left: 1770px;
}
.highlandCliff2Space
{
     width: 410px;
    height: 255px;
       top: 945px;
      left: 2105px;
}
.highlandRavine2Space
{
     width: 410px;
    height: 230px;
       top: 1205px;
      left: 2105px;
}
.highlandHills3Space
{
     width: 330px;
    height: 230px;
       top: 1205px;
      left: 1770px;
}
.highlandGlacierSpace
{
     width: 330px;
    height: 230px;
       top: 1205px;
      left: 1440px;
}
.highlandCliff3Space
{
     width: 325px;
    height: 230px;
       top: 1205px;
      left: 1115px;
}
.highlandCanyon1Space
{
     width: 295px;
    height: 230px;
       top: 1205px;
      left: 820px;
}
.highlandMountainPassSpace
{
     width: 360px;
    height: 305px;
       top: 1130px;
      left: 455px;
}
.highlandCliff4Space
{
     width: 360px;
    height: 260px;
       top: 870px;
      left: 455px;
}
.highlandHills4Space
{
     width: 360px;
    height: 265px;
       top: 605px;
      left: 455px;
}
.highlandPrecipice1Space
{
     width: 360px;
    height: 255px;
       top: 350px;
      left: 455px;
}
.highlandRavine3Space
{
     width: 360px;
    height: 300px;
       top: 45px;
      left: 455px;
}
.highlandHills5Space
{
     width: 395px;
    height: 300px;
       top: 45px;
      left: 60px;
}
.highlandCanyon2Space
{
     width: 395px;
    height: 260px;
       top: 345px;
      left: 60px;
}
.highlandCliff5Space
{
     width: 395px;
    height: 265px;
       top: 345px;
      left: 60px;
}
.highlandWaterfallSpace
{
     width: 395px;
    height: 265px;
       top: 605px;
      left: 60px;
}
.highlandWaterfallSpace
{
     width: 395px;
    height: 265px;
       top: 605px;
      left: 60px;
}
.highlandCanyon2Space
{
     width: 395px;
    height: 260px;
       top: 870px;
      left: 60px;
}
.highlandCliff6Space
{
     width: 395px;
    height: 245px;
       top: 1130px;
      left: 60px;
}
.highlandLostCitySpace
{
     width: 445px;
    height: 365px;
       top: 1380px;
      left: 60px;
}
.highlandPrecipice2Space
{
     width: 310px;
    height: 310px;
       top: 1435px;
      left: 505px;
}
.highlandRavine4Space
{
     width: 300px;
    height: 310px;
       top: 1435px;
      left: 815px;
}
.highlandIceBridgeSpace
{
     width: 470px;
    height: 310px;
       top: 1435px;
      left: 1115px;
}
.highlandCanyon3Space
{
     width: 330px;
    height: 310px;
       top: 1435px;
      left: 1585px;
}
.highlandEyrieSpace
{
     width: 590px;
    height: 310px;
       top: 1435px;
      left: 1915px;
}

/* SPACE HIHGLIGHT */
.highlight
{
    z-index: 5;
    filter: invert(39%) sepia(93%) saturate(1274%) hue-rotate(360deg) brightness(100%) contrast(107%);
}
.topLeftHighlight
{
    background-image: url(assets/board/glow/tl.png);
    background-position: center;
    background-size: 100% 100%;
    width: 100px;
    height: 100px;
    top: 0px;
    left: 0px;
}
.topHighlight
{
    background-image: url(assets/board/glow/t.png);
    background-position: center;
    background-size: 100% 100%;
    width: calc(100% - 200px);
    height: 100px;
    top: 0px;
    left: 100px;
}
.topRightHighlight
{
    background-image: url(assets/board/glow/tr.png);
    background-position: center;
    background-size: 100% 100%;
    width: 100px;
    height: 100px;
    top: 0px;
    right: 0px;
}
.rightHighlight
{
    background-image: url(assets/board/glow/r.png);
    background-position: center;
    background-size: 100% 100%;
    width: 100px;
    height: calc(100% - 200px);
    top: 100px;
    right: 0px;
}
.bottomRightHighlight
{
    background-image: url(assets/board/glow/br.png);
    background-position: center;
    background-size: 100% 100%;
    width: 100px;
    height: 100px;
    bottom: 0px;
    right: 0px;
}
.bottomHighlight
{
    background-image: url(assets/board/glow/b.png);
    background-position: center;
    background-size: 100% 100%;
    width: calc(100% - 200px);
    height: 100px;
    bottom: 0px;
    right: 100px;
}
.bottomLeftHighlight
{
    background-image: url(assets/board/glow/bl.png);
    background-position: center;
    background-size: 100% 100%;
    width: 100px;
    height: 100px;
    bottom: 0px;
    left: 0px;
}
.LeftHighlight
{
    background-image: url(assets/board/glow/l.png);
    background-position: center;
    background-size: 100% 100%;
    width: 100px;
    height: calc(100% - 200px);
    bottom: 100px;
    left: 0px;
}
</style>
</head>
<body>
<div id="gameContainer"></div>
</body>
<!-- TODO merge game data into single json -->
<script src="assets/text/expansions.js"></script>
<script src="assets/text/base_spaces.js"></script>
<script src="assets/text/chars.js"></script>
<script src="assets/text/chars_unsorted.js"></script>
<script>
function fetch(url, type)
{
    return new Promise((resolve, reject)=>
    {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", url, true);

        if (type)
            xhr.responseType = type;

        xhr.addEventListener("load", function ()
        {
            if (xhr.status !== 200)
                resolve(false);
            else
                resolve(xhr.response);

        }, false);
        xhr.send();
    });
}
var storage = {};

function storageInit(db, storeList)
{
    let indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;
    let dbRequest = indexedDB.open(db);

    dbRequest.onupgradeneeded = function(event)
    {
        let db = event.target.result;
        storeList.forEach(function(store)
        {
            if (!db.objectStoreNames.contains(store))
                db.createObjectStore(store);
        });
        db.close();
    }
}

function storageDisconnect(db)
{
    return new Promise(resolve =>
    {
        storage[db].close();
        delete storage[db];
        resolve();
    });
}

function storageConnect(db, version)
{
    return new Promise(function(resolve, reject)
    {
        try
        {
            let indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;

            if (db in storage)
                resolve(storage[db]); //do not connect if already connected

            let dbRequest;
            if (version)
                dbRequest = indexedDB.open(db, version);
            else
                dbRequest = indexedDB.open(db);

            dbRequest.onerror = function(event)
            {
                console.log(event);
                reject(event);
            };

            dbRequest.onsuccess = function(event)
            {
                storage[db] = event.target.result;
                resolve(true);
            };
        }
        catch (error)
        {
            console.log(error);
            reject(error);
        }
    });
}

function storageExists(cmd)
{
    return new Promise(function(resolve, reject)
    {
        try
        {
            let db = storage[cmd.dbName];
            let nameExists = db.objectStoreNames.contains(cmd.store);
            if (nameExists)
            {
                let transaction = db.transaction([cmd.store], 'readwrite');
                let objectStore = transaction.objectStore(cmd.store);
                let objectRequest = objectStore.get(cmd.name);

                objectRequest.onerror = function(event)
                {
                    console.log(event);
                    resolve(false);
                };

                objectRequest.onsuccess = function(event)
                {
                    resolve(event.target.result ? true : false);
                };
            }

        }
        catch (error)
        {
            console.log(error);
            reject(error);
        }
    });
}

function storageGet(cmd)
{
    return new Promise(function(resolve, reject)
    {
        let transaction;
        try
        {
            transaction = storage[cmd.dbName].transaction([cmd.store], 'readonly');
        }
        catch (error)
        {
            console.log(error);
            if (!transaction)
            {
                resolve(event);
            }
        }
        finally
        {
            let objectStore = transaction.objectStore(cmd.store);
            let objectRequest = objectStore.get(cmd.name); // Overwrite if exists

            objectRequest.onerror = function(event)
            {
                console.log(event);
                resolve(event);
            };

            objectRequest.onsuccess = function(event)
            {
                resolve(objectRequest.result);
            };
        }
    });
}

function storagePut(cmd)
{
    return new Promise(async function(resolve, reject)
    {
        let transaction = storage[cmd.dbName].transaction([cmd.store], 'readwrite');
        let objectStore = transaction.objectStore(cmd.store);
        let objectRequest = objectStore.put(cmd.data, cmd.name);
        console.log(objectStore.indexNames);
        objectRequest.onerror = function(event)
        {
            reject(event);
        };

        objectRequest.onsuccess = function(event)
        {
            console.log(event);
            resolve(event.target.result);
        };
    });
}

/* GAME MAP */
let dragging;
let rotating;
let gameMap;
let gameMapInner;
let computedStyle;
let innerWidth;
let innerHeight;
let transform;
function setTransform()
{
    gameMapInner.style.setProperty("transform", "translate3d(" + transform.translate[0] + "px," + transform.translate[1] + "px, 0px) scale(" + transform.scale + ") rotate(" + Math.round(transform.rotate/5)*5 + "deg)");
}

function capMovement()
{
    if (transform.translate[0] > 250)
        transform.translate[0] = 250;
    if (transform.translate[0] < -4346)
        transform.translate[0] = -4346;
    if (transform.translate[1] > 250)
        transform.translate[1] = 250;
    if (transform.translate[1] < -2810)
        transform.translate[1] = -2810;
}

function moveMap(event)
{
    transform.translate[0] += event.movementX * (2.5 * transform.scale);
    transform.translate[1] += event.movementY * (2.5 * transform.scale);

    capMovement()
    setTransform();
}
function rotateMap(event)
{
    let x = event.clientX; //x position in viewport
    let y = event.clientY;  //y position in viewport
    let center = {x: (window.innerWidth)/2, y: (window.innerHeight) /2};
    let translateDelta = {x: x - center.x, y: y - center.y};

    console.log(translateDelta.x)

    if (translateDelta.x < 0)
        transform.rotate += (event.movementY * -1) * 0.2;
    else
        transform.rotate += event.movementY * 0.2;

    if (translateDelta.y < 0)
        transform.rotate += event.movementX * 0.2;
    else
        transform.rotate += event.movementX * -0.2;

    setTransform();
}

function translateMap(event)
{
    gameMapInner.style.setProperty("transition", "transform 0.0s linear");
    if (dragging && event.ctrlKey)
        rotateMap(event);
    else if (dragging && !event.ctrlKey)
        moveMap(event);
    capMovement();
}

function wheelZoom(event)
{
    let scaleMin = 0.2;
    let scaleMax = 1;
    transform.scale += (event.deltaY * -0.0005);
    if (transform.scale < scaleMin)
        transform.scale = scaleMin;
    else if (transform.scale > scaleMax)
        transform.scale = scaleMax;

    let x = event.clientX; //x position in viewport
    let y = event.clientY;  //y position in viewport
    let center = {x: (window.innerWidth)/2, y: (window.innerHeight) /2};
    let translateDelta = {x: x - center.x, y: y - center.y};
    let deltaFraction = 0.2;

    if (transform.scale > scaleMin && transform.scale < scaleMax)
    {
        if (event.deltaY < 0) //if zoom in
            transform.translate[1] -= translateDelta.y * (deltaFraction * 1.5);
        else
            transform.translate[1] -= translateDelta.y * (deltaFraction);

        if (event.deltaY < 0)
            transform.translate[0] -= translateDelta.x * deltaFraction;
        else
            transform.translate[0] -= translateDelta.x * deltaFraction;

        capMovement();
    }
    gameMapInner.style.setProperty("transition", "transform 0.1s linear");
    setTransform();
}
document.addEventListener("wheel", wheelZoom); //set da event

function createSpace(className)
{
    var element = document.createElement("div");
    element.className = "space " + className;

    return element;
}

function createBoard()
{
    gameMap = document.createElement("div");
    gameMap.setAttribute("id", "gameMap");

    gameMapInner = document.createElement("div");
    gameMapInner.setAttribute("id", "gameMapInner");

    let boardBase = document.createElement("div");
    boardBase.setAttribute("class", "boardBase");

    // create spaces
    //main board outer ring
    boardBase.appendChild(createSpace("citySpace"));
    boardBase.appendChild(createSpace("fields1Space"));
    boardBase.appendChild(createSpace("hills1Space"));
    boardBase.appendChild(createSpace("plains1Space"));
    boardBase.appendChild(createSpace("woods1Space"));
    boardBase.appendChild(createSpace("plains2Space"));
    boardBase.appendChild(createSpace("tavernSpace"));
    boardBase.appendChild(createSpace("fields2Space"));
    boardBase.appendChild(createSpace("ruinsSpace"));
    boardBase.appendChild(createSpace("plains3Space"));
    boardBase.appendChild(createSpace("forest3Space"));
    boardBase.appendChild(createSpace("fields3Space"));
    boardBase.appendChild(createSpace("villageSpace"));
    boardBase.appendChild(createSpace("fields4Space"));
    boardBase.appendChild(createSpace("graveyardSpace"));
    boardBase.appendChild(createSpace("woods2Space"));
    boardBase.appendChild(createSpace("sentinelSpace"));
    boardBase.appendChild(createSpace("hills2Space"));
    boardBase.appendChild(createSpace("chapelSpace"));
    boardBase.appendChild(createSpace("fields5Space"));
    boardBase.appendChild(createSpace("cragsSpace"));
    boardBase.appendChild(createSpace("plains4Space"));
    boardBase.appendChild(createSpace("woods3Space"));
    boardBase.appendChild(createSpace("fields6Space"));

    // main board middle ring
    boardBase.appendChild(createSpace("warlocksCaveSpace"));
    boardBase.appendChild(createSpace("desert1Space"));
    boardBase.appendChild(createSpace("oasisSpace"));
    boardBase.appendChild(createSpace("desert2Space"));
    boardBase.appendChild(createSpace("templeSpace"));
    boardBase.appendChild(createSpace("woodsSpace"));
    boardBase.appendChild(createSpace("runesSpace"));
    boardBase.appendChild(createSpace("castleSpace"));
    boardBase.appendChild(createSpace("portalOfPowerSpace"));
    boardBase.appendChild(createSpace("blackKnightSpace"));
    boardBase.appendChild(createSpace("hiddenValleySpace"));
    boardBase.appendChild(createSpace("hillsSpace"));
    boardBase.appendChild(createSpace("cursedGladeSpace"));
    boardBase.appendChild(createSpace("runes2Space"));
    boardBase.appendChild(createSpace("chasmSpace"));
    boardBase.appendChild(createSpace("runes3Space"));

    //main board inner ring
    boardBase.appendChild(createSpace("valleyOfFireSpace"));
    boardBase.appendChild(createSpace("werewolfDenSpace"));
    boardBase.appendChild(createSpace("deathSpace"));
    boardBase.appendChild(createSpace("cryptSpace"));
    boardBase.appendChild(createSpace("plainOfPerilSpace"));
    boardBase.appendChild(createSpace("minesSpace"));
    boardBase.appendChild(createSpace("vampiresTowerSpace"));
    boardBase.appendChild(createSpace("pitsSpace"));
    boardBase.appendChild(createSpace("crownOfCommandSpace"));

    // highland board
    let highlandBoard = document.createElement("div");
    highlandBoard.className = "boardExpansion boardhighland";

    highlandBoard.appendChild(createSpace("highlandEntranceSpace"));
    highlandBoard.appendChild(createSpace("highlandHills1Space"));
    highlandBoard.appendChild(createSpace("highlandCliff1Space"));
    highlandBoard.appendChild(createSpace("highlandRidgewaySpace"));
    highlandBoard.appendChild(createSpace("highlandRavine1Space"));
    highlandBoard.appendChild(createSpace("highlandHills2Space"));
    highlandBoard.appendChild(createSpace("highlandRuinedMineSpace"));
    highlandBoard.appendChild(createSpace("highlandCliff2Space"));
    highlandBoard.appendChild(createSpace("highlandRavine2Space"));
    highlandBoard.appendChild(createSpace("highlandHills3Space"));
    highlandBoard.appendChild(createSpace("highlandGlacierSpace"));
    highlandBoard.appendChild(createSpace("highlandCliff3Space"));
    highlandBoard.appendChild(createSpace("highlandCanyon1Space"));
    highlandBoard.appendChild(createSpace("highlandMountainPassSpace"));
    highlandBoard.appendChild(createSpace("highlandCliff4Space"));
    highlandBoard.appendChild(createSpace("highlandHills4Space"));
    highlandBoard.appendChild(createSpace("highlandPrecipice1Space"));
    highlandBoard.appendChild(createSpace("highlandRavine3Space"));
    highlandBoard.appendChild(createSpace("highlandHills5Space"));
    highlandBoard.appendChild(createSpace("highlandCliff5Space"));
    highlandBoard.appendChild(createSpace("highlandWaterfallSpace"));
    highlandBoard.appendChild(createSpace("highlandCanyon2Space"));
    highlandBoard.appendChild(createSpace("highlandCliff6Space"));
    highlandBoard.appendChild(createSpace("highlandLostCitySpace"));
    highlandBoard.appendChild(createSpace("highlandPrecipice2Space"));
    highlandBoard.appendChild(createSpace("highlandRavine4Space"));
    highlandBoard.appendChild(createSpace("highlandIceBridgeSpace"));
    highlandBoard.appendChild(createSpace("highlandCanyon3Space"));
    highlandBoard.appendChild(createSpace("highlandEyrieSpace"));

    //city board
    let cityBoard = document.createElement("div");
    cityBoard.className = "boardExpansion boardCity";

    cityBoard.appendChild(createSpace("cityGateSpace"));
    cityBoard.appendChild(createSpace("citySquareOfKingsSpace"));
    cityBoard.appendChild(createSpace("cityRoyalLaneSpace"));
    cityBoard.appendChild(createSpace("citySouthSideAlleySpace"));
    cityBoard.appendChild(createSpace("citySanctuarySquareSpace"));
    cityBoard.appendChild(createSpace("cityHighTempleSpace"));
    cityBoard.appendChild(createSpace("cityNobleStreetSpace"));
    cityBoard.appendChild(createSpace("cityAcademySpace"));
    cityBoard.appendChild(createSpace("cityFlaskStreetSpace"));
    cityBoard.appendChild(createSpace("cityApothecarySpace"));
    cityBoard.appendChild(createSpace("cityElementalAvenueSpace"));
    cityBoard.appendChild(createSpace("citySorcererSquareSpace"));
    cityBoard.appendChild(createSpace("cityTownSquareSpace"));
    cityBoard.appendChild(createSpace("cityMagicEmporiumSpace"));
    cityBoard.appendChild(createSpace("cityJailSpace"));
    cityBoard.appendChild(createSpace("citySoothsayerSpace"));
    cityBoard.appendChild(createSpace("cityGuildStreetSpace"));
    cityBoard.appendChild(createSpace("cityArmourySpace"));
    cityBoard.appendChild(createSpace("cityRatsRoadSpace"));
    cityBoard.appendChild(createSpace("cityMenagerieSpace"));
    cityBoard.appendChild(createSpace("cityDroppingsLaneSpace"));
    cityBoard.appendChild(createSpace("cityStablesSpace"));
    cityBoard.appendChild(createSpace("cityBeggarsRowSpace"));
    cityBoard.appendChild(createSpace("cityWharfSpace"));
    cityBoard.appendChild(createSpace("cityThievesAlleySpace"));
    cityBoard.appendChild(createSpace("cityRoguesGuildSpace"));
    cityBoard.appendChild(createSpace("cityNorthSideAlleySpace"));
    cityBoard.appendChild(createSpace("cityCobbleLaneSpace"));
    cityBoard.appendChild(createSpace("cityGoldStreetSpace"));
    cityBoard.appendChild(createSpace("citySpeakersCornerSpace"));

    //dungeon board
    let dungeonBoard = document.createElement("div");
    dungeonBoard.className = "boardExpansion boardDungeon";

    dungeonBoard.appendChild(createSpace("dungeonEntranceSpace"));
    dungeonBoard.appendChild(createSpace("dungeonCorridor1Space"));
    dungeonBoard.appendChild(createSpace("dungeonTunnel1Space"));
    dungeonBoard.appendChild(createSpace("dungeonLibrarySpace"));
    dungeonBoard.appendChild(createSpace("dungeonCavern1Space"));
    dungeonBoard.appendChild(createSpace("dungeonCorridor2Space"));
    dungeonBoard.appendChild(createSpace("dungeonGuardRoomSpace"));
    dungeonBoard.appendChild(createSpace("dungeonTunnel2Space"));
    dungeonBoard.appendChild(createSpace("dungeonCavern2Space"));
    dungeonBoard.appendChild(createSpace("dungeonCorridor3Space"));
    dungeonBoard.appendChild(createSpace("dungeonCellSpace"));
    dungeonBoard.appendChild(createSpace("dungeonTunnel3Space"));
    dungeonBoard.appendChild(createSpace("dungeonVault1Space"));
    dungeonBoard.appendChild(createSpace("dungeonHallOfDarknessSpace"));
    dungeonBoard.appendChild(createSpace("dungeonTunnel4Space"));
    dungeonBoard.appendChild(createSpace("dungeonCorridor4Space"));
    dungeonBoard.appendChild(createSpace("dungeonKitchenSpace"));
    dungeonBoard.appendChild(createSpace("dungeonCavern3Space"));
    dungeonBoard.appendChild(createSpace("dungeonCorridor5Space"));
    dungeonBoard.appendChild(createSpace("dungeonTunnel5Space"));
    dungeonBoard.appendChild(createSpace("dungeonTortureChamberSpace"));
    dungeonBoard.appendChild(createSpace("dungeonVault2Space"));
    dungeonBoard.appendChild(createSpace("dungeonCorridor6Space"));
    dungeonBoard.appendChild(createSpace("dungeonMonsterPitSpace"));
    dungeonBoard.appendChild(createSpace("dungeonTunnel6Space"));
    dungeonBoard.appendChild(createSpace("dungeonCavern4Space"));
    dungeonBoard.appendChild(createSpace("dungeonSummoningCircleSpace"));
    dungeonBoard.appendChild(createSpace("dungeonVault3Space"));
    dungeonBoard.appendChild(createSpace("dungeonTresureChamberSpace"));

    //woodland board
    let woodlandBoard = document.createElement("div");
    woodlandBoard.className = "boardExpansion boardWoodland";

    woodlandBoard.appendChild(createSpace("woodlandEntranceSpace"));
    woodlandBoard.appendChild(createSpace("woodlandWoods1Space"));
    woodlandBoard.appendChild(createSpace("woodlandGlade1Space"));
    woodlandBoard.appendChild(createSpace("woodlandFaerieRingSpace"));
    woodlandBoard.appendChild(createSpace("woodlandThicket1Space"));
    woodlandBoard.appendChild(createSpace("woodlandWoods2Space"));
    woodlandBoard.appendChild(createSpace("woodlandWitchTreeSpace"));
    woodlandBoard.appendChild(createSpace("woodlandGlade2Space"));
    woodlandBoard.appendChild(createSpace("woodlandThicket2Space"));
    woodlandBoard.appendChild(createSpace("woodlandWoods3Space"));
    woodlandBoard.appendChild(createSpace("woodlandCrossroadsSpace"));
    woodlandBoard.appendChild(createSpace("woodlandGlade3Space"));
    woodlandBoard.appendChild(createSpace("woodlandDenseForestSpace"));
    woodlandBoard.appendChild(createSpace("woodlandSwamplandSpace"));
    woodlandBoard.appendChild(createSpace("woodlandGlade4Space"));
    woodlandBoard.appendChild(createSpace("woodlandWoods4Space"));
    woodlandBoard.appendChild(createSpace("woodlandBog1Space"));
    woodlandBoard.appendChild(createSpace("woodlandThicket3Space"));
    woodlandBoard.appendChild(createSpace("woodlandFaerieVillage1Space"));
    woodlandBoard.appendChild(createSpace("woodlandGlade5Space"));
    woodlandBoard.appendChild(createSpace("woodlandBlastedHeathSpace"));
    woodlandBoard.appendChild(createSpace("woodlandDenseForest1Space"));
    woodlandBoard.appendChild(createSpace("woodlandFaerieVillage2Space"));
    woodlandBoard.appendChild(createSpace("woodlandMysticGlenSpace"));
    woodlandBoard.appendChild(createSpace("woodlandBog2Space"));
    woodlandBoard.appendChild(createSpace("woodlandThicket4Space"));
    woodlandBoard.appendChild(createSpace("woodlandMabsLairSpace"));
    woodlandBoard.appendChild(createSpace("woodlandDenseForest2Space"));
    woodlandBoard.appendChild(createSpace("woodlandMeetingWithDestinySpace"));

    gameMapInner.appendChild(boardBase);
    gameMapInner.appendChild(woodlandBoard);
    gameMapInner.appendChild(cityBoard);
    gameMapInner.appendChild(dungeonBoard);
    gameMapInner.appendChild(highlandBoard);
    //append spaces
    gameMap.appendChild(gameMapInner);


    // append game map events
    gameMap.addEventListener("mousedown", function(event)
    {
        dragging = true;
        gameMapInner.style.setProperty("cursor", "grabbing");
        gameMap.addEventListener("mousemove", translateMap);
    });

    gameMap.addEventListener("mouseup", function(event)
    {
        dragging = false;
        gameMapInner.style.setProperty("cursor", "grab");
    });

    //append map to game container
    let gameContainer = document.querySelector("#gameContainer");
    gameContainer.appendChild(gameMap);

    //space highlight event
    document.querySelectorAll(".space").forEach(function(space)
    {
        space.addEventListener("mouseenter", function(event)
        {
            let tl = document.createElement("div");
            tl.className = "highlight topLeftHighlight";

            let t = document.createElement("div");
            t.className = "highlight topHighlight";

            let tr = document.createElement("div");
            tr.className = "highlight topRightHighlight";

            let r = document.createElement("div");
            r.className = "highlight rightHighlight";

            let br = document.createElement("div");
            br.className = "highlight bottomRightHighlight";

            let b = document.createElement("div");
            b.className = "highlight bottomHighlight";

            let bl = document.createElement("div");
            bl.className = "highlight bottomLeftHighlight";

            let l = document.createElement("div");
            l.className = "highlight leftHighlight";

            event.target.appendChild(tl);
            event.target.appendChild(t);
            event.target.appendChild(tr);
            event.target.appendChild(t);
            event.target.appendChild(br);
            event.target.appendChild(r);
            event.target.appendChild(b);
            event.target.appendChild(bl);
            event.target.appendChild(l);
        });

        space.addEventListener("mouseleave", function(event)
        {
            setTimeout(function(target)
            {
                target.querySelectorAll(".highlight").forEach(function(highlight)
                {
                    highlight.parentNode.removeChild(highlight);
                });
            }, 300, event.target);
        });
    });



    //COMPUTE
    computedStyle = window.getComputedStyle(gameMapInner);
    innerWidth = parseInt(window.getComputedStyle(gameMapInner).width.replace("px", ""));
    innerHeight = parseInt(window.getComputedStyle(gameMapInner).height.replace("px", ""));
    transform = {translate: [innerWidth*-0.35, innerHeight*-0.37], scale: 0.4, rotate: 0}

    setTransform();


}

async function ass()
{
    //connect db
    await storageInit("Talisman", ["boardAssets", "minisAssets", "uiAssets", "tokensAssets"]);
    await storageConnect("Talisman");

    createBoard();

    //main board
    let bbReq = {store: "boardAssets", name: "boardBase", dbName: "Talisman"};
    if (!await storageExists(bbReq)) //cache
    {
        bbReq.data = await fetch(window.location.origin + "/assets/board/base.png", "blob");
        let bbRes = await storagePut(bbReq);
    }

    //load
    let bbRes = await storageGet(bbReq);
    var URL = window.URL || window.webkitURL;
    var bbIMGURL = URL.createObjectURL(bbRes);
    var bbElement = document.querySelector(".boardBase");
    bbElement.style.setProperty("background-image", "url(" + bbIMGURL + ")");

    //highland
    let bhReq = {store: "boardAssets", name: "boardhighland", dbName: "Talisman"};
    if (!await storageExists(bhReq)) //cache
    {
        bhReq.data = await fetch(window.location.origin + "/assets/board/highland.png", "blob");
        let bhRes = await storagePut(bhReq);
    }

    //load
    let bhRes = await storageGet(bhReq);
    var bhIMGURL = URL.createObjectURL(bhRes);
    var bhElement = document.querySelector(".boardExpansion.boardhighland");
    bhElement.style.setProperty("background-image", "url(" + bhIMGURL + ")");


    //city
    let bcReq = {dbName: "Talisman", store: "boardAssets", name: "boardCity"};
    if (!await storageExists(bcReq))
    {
        bcReq.data = await fetch(window.location.origin + "/assets/board/city.png", "blob");
        let bcRes = await storagePut(bcReq);
    }

    //load
    bcRes = await storageGet(bcReq);
    var bcIMGURL = URL.createObjectURL(bcRes);
    var bcElement = document.querySelector(".boardExpansion.boardCity");
    bcElement.style.setProperty("background-image", "url(" + bcIMGURL + ")");

    //woodlands
    let bwReq = {dbName: "Talisman", store: "boardAssets", name: "boardWoodlands"};
    if (!await storageExists(bwReq))
    {
        bwReq.data = await fetch(window.location.origin + "/assets/board/woodland.png", "blob");
        let bwRes = await storagePut(bwReq);
    }

    //load
    bwRes = await storageGet(bwReq);
    var bwIMGURL = URL.createObjectURL(bwRes);
    var bwElement = document.querySelector(".boardExpansion.boardWoodland");
    bwElement.style.setProperty("background-image", "url(" + bwIMGURL + ")");

    //dungeon
    let bdReq = {dbName: "Talisman", store: "boardAssets", name: "boardDungeon"};
    if (!await storageExists(bdReq))
    {
        bdReq.data = await fetch(window.location.origin + "/assets/board/dungeon.png", "blob");
        let bdRes = await storagePut(bdReq);
    }

    //load
    let bdRes = await storageGet(bdReq);
    var bdIMGURL = URL.createObjectURL(bdRes);
    var bdElement = document.querySelector(".boardExpansion.boardDungeon");
    bdElement.style.setProperty("background-image", "url(" + bdIMGURL + ")");

    // //TODO: precache highlight alphas
    //
    // let charCard = await fetch(window.location.origin + "/assets/chars/char_card.png", "blob");
    // let charCardReq = {db: "Talisman", store: "charAssets", data: charCard, name: "charCard"};
    // console.log(await storageExists(charCardReq));
    //
    // let charCardRes = await storagePut(charCardReq);
    // charCardRes = await storageGet(charCardReq);
    //
    // var charCardIMGURL = URL.createObjectURL(charCardRes);
    // var charCardElement = document.querySelector(".charCard");
    // charCardElement.style.setProperty("background-image", "url(" + charCardIMGURL + ")");

    //TODO: auto db update and store create on put

    //removes image on opera
    // URL.revokeObjectURL(imgURL);


}

// ass();
let player = {name: "testboi", id:"123456789"};
let currentGameLobby;
let savedGames = [];
let openGames = [];
let gameDetails =
{
    "asdfghjkl123456789":
    {
        id: "asdfghjkl123456789",
        owner: {name: "testboi", id:"123456789"},
        playerCount: 5,
        status: "load",
        turn: 25,
        players: [{name: "testboi", id:"123456789", char: ""},
                {name: "putin", id: "6661", char: "Assassin"},
                {name: "trump", id: "6662", char: "Troll"},
                {name: "xijingping", id: "6663", char: "Dark Cultist"},
                {name: "kimjongun", id: "6664", char: "Barbarian"}],
        rules:
        {
            expansions: ["The Ancient Beasts", "The Blood Moon", "The City",
                        "The Deep Realm", "The Sacred Pool"],
            characters: ["The Ancient Beasts", "The Blood Moon", "The Cataclysm",
                        "The City", "The Clockwork Kingdom", "The Deep Realm",
                        "The Dragon", "The Dungeon", "The Firelands", "The Forstmarch",
                        "The Harbinger", "The Highland", "The Nether Realm", "The Realm of Souls",
                        "The Reaper", "The Sacred Pool", "The Woodland"]
        }
    },
    "987654321lkjhgfdsa":
    {
        id: "987654321lkjhgfdsa",
        owner: {name: "testboi", id:"123456789"},
        playerCount: 4,
        status: "fresh",
        turn: 0,
        players: [{name: "testboi", id:"123456789", char: ""},
                {name: "putin", id: "6661", char: "Conman"},
                {name: "trump", id: "6662", char: "Leprechaun"},
                {name: "kimjongun", id: "6664", char: "Grave Robber"}],
        rules : {expansions : [], characters : []}
    }
}

function fetchSavedGames()
{
    let game =
    {
        id: "asdfghjkl123456789",
        owner: {name: "testboi", id:"123456789"},
        playerCount: 5,
        slots: 6,
        status: "load",
        turn: 25
    }

    savedGames.push(game);
}

function fetchOpenGames()
{
    let game =
    {
        id: "987654321lkjhgfdsa",
        owner: {name: "testboi", id:"123456789"},
        playerCount: 4,
        slots: 6,
        status: "fresh",
        turn: 0
    };
    openGames.push(game);
}

// PARSE GAME OBJECT TO ELEMENT
function parseGame(game, type)
{
    let element = document.createElement("div");
    element.className = type + "Game";
    element.setAttribute("gameid", game.id);

    let gameTypeElement = document.createElement("div");
    gameTypeElement.className = "gameTypeIcon";
    gameTypeElement.textContent = (game.status == "fresh") ? "" : "";

    let ownerElement = document.createElement("div");
    ownerElement.className = "gameOwner";
    ownerElement.textContent = game.owner.name + "'s game";

    let slotsElement = document.createElement("div");
    slotsElement.className = "gameSlots";
    slotsElement.textContent = game.playerCount + " / " + game.slots + " players";

    let statusElement = document.createElement("div");
    statusElement.className = "gameStatus";
    statusElement.textContent = (game.status == "fresh") ? "Not started yet" : (game.turn + " turn load");

    element.addEventListener("click", loadLobby);

    element.appendChild(gameTypeElement);
    element.appendChild(ownerElement);
    element.appendChild(slotsElement);
    element.appendChild(statusElement);

    return element;
}

// FETCH AVAILABLE GAMES
async function fetchGames()
{
    fetchSavedGames();
    fetchOpenGames();

    let gameListElement = document.querySelector(".gameList");

    //draw saved games
    savedGames.forEach(function(game)
    {
        gameListElement.appendChild(parseGame(game, "load"));
    });

    //draw open games
    openGames.forEach(function(game)
    {
        gameListElement.appendChild(parseGame(game, "open"));
    });
}

function selectCharacter(name)
{
    //select char
    let slotID;
    for (var i = 0, l = currentGameLobby.players.length; i < l; i++)
    {
        let lobbyPlayer = currentGameLobby.players[i];
        if (lobbyPlayer.name == player.name)
        {
            lobbyPlayer.char = name;
            slotID = i;
        }
    }

    let slot = document.querySelector(".gameSlot:nth-child(" + slotID + 1  + ")");
    slot.querySelector(".slotCharPic").style.setProperty("background-image", "url(assets/chars/" + ((name != "Random") ? charsSorted[name].filePrefix : "random") + "_picture.png)");
    slot.querySelector(".slotCharName").textContent = name;


    let selector = document.querySelector(".characterSelector");
    selector.parentNode.removeChild(selector);
    //close character selector
}

function selectCharacterEvent(event)
{
    selectCharacter(event.target.getAttribute("name"));
}

function searchCharacterName(event)
{
    if (event.keyCode === 13)
    {
        let chars = document.querySelectorAll(".charSelectorCharContainer");

        chars.forEach(function(char)
        {
            if (char.style.getPropertyValue("display") == "inline-block")
                selectCharacter(char.getAttribute("name"));

        });

        event.preventDefault();
        return;
    }

    document.querySelectorAll(".charSelectorCharContainer").forEach(function(mini)
    {
        if (mini.getAttribute("name").toLowerCase().search(event.target.value.toLowerCase()) > -1)
        {
            mini.style.setProperty("opacity", "1");
            mini.style.setProperty("display", "inline-block");
        }
        else
        {
            mini.style.setProperty("opacity", 0);
            setTimeout(function(mini){ mini.style.setProperty("display", "none"); }, 200, mini);
        }
    });
}

let charsSorted = {};
//sort chars
function sortCharacters()
{
    let charsTemp = {};
    for (let expansionName in chars)
    {
        let expansion = chars[expansionName];

        for (let charName in expansion)
        {
            charsTemp[charName] = expansion[charName];
        }
    }
    charsSorted = {};
    Object.keys(charsTemp).sort().forEach(function(key) { charsSorted[key] = charsTemp[key]; });
}

function displayCharacterDescription(event)
{
    let description = document.querySelector(".characterSelectorDescription");
    description.style.setProperty("display", "block");
    description.innerHTML = charsSorted[event.target.getAttribute("name")].description;
}

function removeCharacterDescription(event)
{
    let description = document.querySelector(".characterSelectorDescription");
    description.style.setProperty("display", "none");
}

let charStatLookupTable = {strength: {}, craft: {}, fate: {}, life: {}};
function openCharacterSelector()
{
    let characterSelector = document.createElement("div");
    characterSelector.className = "characterSelector";

    //character name search input field
    let nameSearchLabel = document.createElement("div");
    nameSearchLabel.className = "nameSearchLabel";
    nameSearchLabel.textContent = "Search character name:";

    let nameSearchInput = document.createElement("input");
    nameSearchInput.className = "nameSearchInput";
    nameSearchInput.type = "text";
    nameSearchInput.addEventListener("keyup", searchCharacterName);

    let characterPicker = document.createElement("div");
    characterPicker.className = "characterPicker";

    //character picker scroll
    characterPicker.addEventListener("mousewheel", function(event)
    {
        characterPicker.scrollLeft += event.deltaY;
        event.preventDefault();
    });

    //create random character icon
    let randomContainer = document.createElement("div");
    randomContainer.className = "charSelectorCharContainer";

    let randomName = document.createElement("div");
    randomName.className = "characterSelectorName";
    randomName.textContent = "Random";

    randomContainer.style.backgroundImage = "url(" + window.location.origin + "/assets/chars/random_card.png)";
    randomContainer.setAttribute("name", "Random");

    randomContainer.addEventListener("click", selectCharacterEvent);

    randomContainer.appendChild(randomName);
    characterPicker.appendChild(randomContainer);

    //create character icons
    for (let charName in charsSorted)
    {
        let character = charsSorted[charName];
        let charContainer = document.createElement("div");
        charContainer.className = "charSelectorCharContainer";

        let characterName = document.createElement("div");
        characterName.className = "characterSelectorName";
        characterName.textContent = charName;

        charContainer.style.backgroundImage = "url(" + window.location.origin + "/assets/chars/" + character.filePrefix + "_miniature.png)";
        charContainer.setAttribute("name", charName);

        charContainer.addEventListener("click", selectCharacterEvent);
        charContainer.addEventListener("mouseover", displayCharacterDescription);
        charContainer.addEventListener("mouseout", removeCharacterDescription);

        charContainer.appendChild(characterName);
        characterPicker.appendChild(charContainer);
    }

    //character description
    let charDescription = document.createElement("div");
    charDescription.className = "characterSelectorDescription";

    //character stats filter
    //prepare lookup table
    for (let charName in charsSorted)
    {
        let char = charsSorted[charName];

        if (!charStatLookupTable.strength[char.strength])
            charStatLookupTable.strength[char.strength] = [];
        if (!charStatLookupTable.craft[char.craft])
            charStatLookupTable.craft[char.craft] = [];
        if (!charStatLookupTable.fate[char.fate])
            charStatLookupTable.fate[char.fate] = [];
        if (!charStatLookupTable.life[char.life])
            charStatLookupTable.life[char.life] = [];


        charStatLookupTable.strength[char.strength].push(char);
        charStatLookupTable.craft[char.craft].push(char);
        charStatLookupTable.fate[char.fate].push(char);
        charStatLookupTable.life[char.life].push(char);
    };
    console.log(charStatLookupTable);

    //append all that shit
    characterSelector.appendChild(nameSearchLabel);
    characterSelector.appendChild(nameSearchInput);
    characterSelector.appendChild(characterPicker);
    characterSelector.appendChild(charDescription);

    document.body.appendChild(characterSelector);
}

let readyPlayers = [];
function togglePlayerReady(event)
{
    let playerName = event.target.parentNode.querySelector(".slotPlayerName").textContent;

    if (player.name != playerName)
        return;

    if (!readyPlayers.includes(playerName))
    {
        readyPlayers.push(playerName);
        event.target.style.setProperty("background-image", "url(assets/ui/ready_icon.png)");
    }
    else
    {
        readyPlayers = readyPlayers.filter(function(e) { return e !== playerName });
        event.target.style.setProperty("background-image", "url(assets/ui/ready_button.png)");
    }
}

// set lobby slot display
function setLobbySlot(game, slotID)
{
    let gameSlot = document.createElement("div");
    gameSlot.className = "gameSlot";

    let playerName = document.createElement("div");
    playerName.className = "slotPlayerName";

    let slotPlayer = game.players[slotID];

    playerName.textContent = slotPlayer ? slotPlayer.name : "";

    let charPic = document.createElement("div");
    charPic.className = "slotCharPic";
    charPic.style.setProperty("background-image", "url(" + ((slotPlayer.char.length > 0) ? "assets/chars/" + charsSorted[slotPlayer.char].filePrefix : "assets/chars/random") + "_picture.png)");

    let charName = document.createElement("div");
    charName.className = "slotCharName";
    charName.textContent = (slotPlayer.char.length > 0) ? slotPlayer.char : "Random";

    let readyButton = document.createElement("div");
    readyButton.className = "readyButton";
    readyButton.style.setProperty("background-image", "url(assets/ui/ready_button.png)");

    readyButton.addEventListener("click", togglePlayerReady);

    if (player.id == slotPlayer.id)
    {
        charPic.classList.add("clickable");
        charPic.addEventListener("click", openCharacterSelector);
        readyButton.style.setProperty("cursor", "pointer");
    }

    //slot remove element

    gameSlot.appendChild(playerName);
    gameSlot.appendChild(charPic);
    gameSlot.appendChild(charName);
    gameSlot.appendChild(readyButton);

    return gameSlot;
}

function leaveLobby()
{
    currentGameLobby = {};
    readyPlayers = [];
    let lobby = document.querySelector(".gameLobby");
    lobby.parentNode.removeChild(lobby);
    loadGameList();
}

function loadLobby(event)
{
    //empty game list containers
    savedGames = [];
    openGames = [];

    sortCharacters();
    //TODO
    //game expansions

    let gameLobby = document.createElement("div");
    gameLobby.className = "gameLobby";

    let gameSlotsContainer = document.createElement("div");
    gameSlotsContainer.className = "gameSlotsContainer";

    //get selected game details

    currentGameLobby = gameDetails[event.target.getAttribute("gameid")];

    for (var i = 0; i < currentGameLobby.playerCount; i++)
    {
        gameSlotsContainer.appendChild(setLobbySlot(currentGameLobby, i));
    }

    let meOut = document.createElement("div");
    meOut.className = "letMeOutButton";
    meOut.textContent = "Let me out!";
    meOut.addEventListener("click", leaveLobby);

    gameSlotsContainer.appendChild(meOut);
    gameLobby.appendChild(gameSlotsContainer);
    document.querySelector("#gameContainer").appendChild(gameLobby);

    let gameList = document.querySelector(".gameList");
    gameList.parentNode.removeChild(gameList);

    //sync host state
}

function loadGameList()
{
    let gameList = document.createElement("div");
    gameList.className = "gameList";

    document.querySelector(".mainMenu").appendChild(gameList);
    fetchGames();
}

async function mainMenu()
{
    let mainMenu = document.createElement("div");
    mainMenu.className = "mainMenu";

    let logo = document.createElement("div");
    logo.className = "logo";

    mainMenu.appendChild(logo);

    document.querySelector("#gameContainer").appendChild(mainMenu);

    loadGameList();
}

ass();

// mainMenu();
/*
login
display open games
create game
    select expansion characters
    select expansion cards/board
    game password
    remove player from the game
join selected game
select character
load board
    shuffle cards
    place decks
    place characters
character setup round
    draw spells
    pick items
    assign fate

game
    turn order
    turn counter
    roll
        add/substract points
        dice
            roll movement
            roll against space
            roll against card
            roll against monster
            roll against event
    give to player
        possession
            item
            trophy
            follower
            token
            spell
    move character to space
    draw card from top
    select particular hard
    browse x
        take from browsed group
        discard from browsed group
        place on top
        place on bottom
    show cards on space
    select inner board alternatives
        dragon realm
        dragon tower
*/
</script>
</html>
