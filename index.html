<html>
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
body
{
    margin: 0;
    overflow: hidden;
    width: 100vw;
    height: 100vh;
}
#gameContainer
{
    margin: 0;
    overflow: hidden;
    width: 100vw;
    height: 100vh;
    background-color: black;
}
.hidden
{
    display: none;
}
/* MAIN MENU */
.mainMenu
{
    width: 100%;
    height: 100%;
}
.logo
{
    width: 30vw;
    height: 15vw;
    left: 35vw;
    position: absolute;
    background-image: url(assets/ui/logo.png);
    background-size: 100% 100%;
    animation: logoSkew 15s infinite;
    animation-timing-function: ease-in-out;
}
@keyframes logoSkew
{
    0% { transform: skew(0deg); }
    25% { transform: skew(5deg); }
    75% { transform: skew(-5deg); }
    100% { transform: skew(0deg); }
}

@font-face
{
  font-family: Caxton;
  src: url(assets/fonts/CaxtonStd-Book.otf);
}

@font-face
{
  font-family: Windlass;
  src: url(assets/fonts/Windlass.ttf);
}

.gameList
{
    width: 60vw;
    left: 20vw;
    position: absolute;
    height: 25vw;
    top: 17.5vw;
    overflow-x: hidden;
    overflow-y: auto;
    user-select: none;
}
.loadGame, .openGame
{
    display: inline-block;
    font-family: Windlass;
    border-radius: 1vw;
    border: 0px;
    margin: 0.5vw 0vw 0.5vw 0vw;
    line-height: 2vw;
    cursor: pointer;
    width: 98%;
    font-size: 1vw;
}
.loadGame:hover
{
    animation: openGameHover 3s infinite;
}
@keyframes openGameHover
{
    0% { background-color: #3ed33e99; }
    50% { background-color: #3ed33ecc; }
    100% { background-color: #3ed33e99; }
}
.openGame:hover
{
    animation: savedGameHover 3s infinite;
}
@keyframes savedGameHover
{
    0% { background-color: #64d5f299; }
    50% { background-color: #64d5f2cc; }
    100% { background-color: #64d5f299; }
}
.loadGame
{
    background-color: #3ed33e99;
}
.openGame
{
    background-color: #64d5f299;
}
.loadGame div, .openGame div
{
    display: inline-block;
    text-align: center;
    pointer-events: none;
    user-select: none;
}
.gameTypeIcon
{
    width: 5%;
}
.gameOwner
{
    width: 30%;
}
.gameSlots
{
    width: 35%;
}
.gameStatus
{
    width: 30%;
}

/* GAME LOBBY */
.gameLobby
{

}
.gameSlotsContainer
{
    user-select: none;
    width: 60vw;
    left: 20vw;
    position: absolute;
    height: 25vw;
    top: 17.5vw;
}
.gameSlot
{
    display: inline-block;
    font-family: Windlass;
    border-radius: 1vw;
    border: 0px;
    margin: 0.25vw 0vw 0.25vw 0vw;
    line-height: 3vw;
    width: 98%;
    font-size: 1vw;
    background: #c0c0c099;
    z-index: 5;
    transition: background-color 0.25s linear;
    height: 3vw;
}
.gameSlot:hover
{
    background-color: #c0c0c0cc;
}
.gameSlot div, .gameSlot div
{
    display: block;
    text-align: center;
}
.slotPlayerName
{
    position: absolute;
    left: 0%;
    pointer-events: none;
    width: 40%;
}
.slotCharPic
{
    position: absolute;
    left: 40%;
    background-size: 22.5% 100%;
    background-repeat: no-repeat;
    background-position: center;
    width: 25%;
    min-height: 3vw;
}
.clickable
{
    cursor: pointer;
}
.slotCharName
{
    position: absolute;
    left: 65%;
    pointer-events: none;
    width: 25%;
}
.readyButton
{
    min-width: 5%;
    min-height: 3vw;
    background-size: 100% 100%;
    width: 5%;
    left: 92.5%;
    position: absolute;
}
.readyIcon
{
    background-size: 100% 100%;
    width: 100%;
    height: 100%;
}

/* CHARACTER SELECTOR */
.characterSelector
{
    width: 100vw;
    height: 100vw;
    position: absolute;
    background-color: black;
    z-index: 4;
    top: 0;
    left: 0;
}

.characterPicker
{
    width: 100vw;
    height: 17vw;
    overflow-x: scroll;
    overflow-y: hidden;
    white-space: nowrap;
    top:  8vw;
    position: absolute;
}
.nameSearchInput
{
    position: absolute;
    left: 42.5vw;
    top: 3vw;
    width: 15vw;
    font-family: Windlass;
    font-size: 1.2vw;
    line-height: 2vw;
    background-color: transparent;
    border: 0px;
    outline: none;
    background-image: url(assets/ui/paper_title.png);
    background-size: 100% 100%;
    text-align: center;
}
.nameSearchLabel
{
    position: absolute;
    left: 26.5vw;
    top: 3.2vw;
    width: 16vw;
    color: white;
    font-family: Windlass;
    font-size: 1.2vw;
    line-height: 2vw;
    user-select: none;
}

.charSelectorCharContainer
{
    display: inline-block;
    width: 10vw;
    height: 15vw;
    margin: 0vw 1vw 0vw 1vw;
    padding: 0.5vw 1vw 1vw 1vw;
    transition: background-color 0.3s ease-out, opacity 0.2s linear;
    border-radius: 2vw;
    cursor: pointer;
    background-size: 100% 100%;
    opacity: 1;
    user-select: none;
}
.charSelectorCharContainer:hover
{
    background-color: #64d5f299;
}
.characterSelectorMini
{
    width: inherit;
    height: inherit;
    pointer-events: none;
}
.characterSelectorName
{
    width: 13vw;
    height: 2vw;
    position: relative;
    left: -1.5vw;
    font-family: Windlass;
    font-size: 1.2vw;
    line-height: 2vw;
    background-image: url(assets/ui/paper_title.png);
    background-size: 100% 100%;
    text-align: center;
    pointer-events: none;
}
.characterSelectorDescription
{
    top: 25.5vw;
    left: 30vw;
    width: 40vw;
    height: 20vw;
    text-align: center;
    pointer-events: none;
    background-image: url(assets/ui/paper.png);
    background-size: 100% 100%;
    z-index: 5;
    position: absolute;
    font-family: Caxton;
    font-size: 0.8vw;
    line-height: 1vw;
    white-space: pre-wrap;
    padding: 1vw 2vw 0vw 2vw;
    user-select: none;
}
.characterStatFilter
{

}
.letMeOutButton
{
    position: absolute;
    top: -4vw;
    left: 48vw;
    width: 9vw;
    font-family: Windlass;
    font-size: 1vw;
    line-height: 2vw;
    border-radius: 3vw;
    background-color: #c0c0c099;
    padding: 0.5vw 0.5vw 0.5vw 1vw;
    cursor: pointer;
}
.letMeOutButton:before
{
    position: absolute;
    top: 0vw;
    right: 0vw;
    display: block;
    content: " ";
    width: 3vw;
    height: 3vw;
    background-image: url(assets/ui/let_me_out_button.png);
    background-size: 100% 100%;
    background-position: right;
    background-repeat: no-repeat;
}
/* CONTAINERS */
#gameMap
{
    overflow: hidden;
    width: 100vw;
    height: 100vh;
    background-image: url(bg.jpg);
    background-size: 100% 100%;
}
#gameMapInner
{
    width: 6353px;
    height: 3792px;
    cursor: grab;
    user-select: none;
    transform-origin: center;
}
/* BOARD MAPS*/
.boardBase
{
    width: 4096px;
    height: 2048px;
    top: 885px;
    left: 1114px;
    position: absolute;
}
.boardExpansion
{
    width: 2560px;
    height: 1792px;
    position: absolute;
}
.centerOverlay
{
    z-index: 4;
}
.expansionOverlay
{
    z-index: 3;
}

.boardWoodland
{
    top: 1990px;
    left: 3790px;
}
.boardCity
{
    top: 0px;
    left: 0px;
}
.boardDungeon
{
    top: 0px;
    left: 3790px;
}
.boardHighland
{
    top: 1990px;
    left: 0px;
}
.boardDeeprealm
{
    width: 1280px;
    height: 640px;
    top: 250px;
    left: 2537px;
    position: absolute;
}

.centerBackground
{
    z-index: 2;
    background-size: 100% 100%;
}
.expansionBackground
{
    z-index: 1;
    background-size: 100% 100%;
}


/* BASE BOARD SPACES */
.space
{
    position: absolute;
}
.space:hover .highlight
{
    opacity: 0.5;
    animation: fadeIn 1s infinite;
}
.space:hover .spaceDescriptionContainer
{
    opacity: 1;
}
@keyframes fadeIn
{
    0% {opacity: 0.5}
    50% {opacity: 0.75}
    100% {opacity: 0.5}
}
@keyframes fadeOut
{
    0% {opacity: 0.5}
    100% {opacity: 0.0}
}

.charCard
{
    width: 1230px;
    height: 815px;
    top: 2048px;
    left: 1446px;
    background-size: 100% 100%;
}

/* OUTER RING */
.citySpace
{
    width: 555px;
    height: 300px;
    top: 33px;
    left: 44px;
}
.fields1Space
{
    width: 585px;
    height: 300px;
    top: 33px;
    left: 595px;
}
.hills1Space
{
    width: 577px;
    height: 300px;
    top: 33px;
    left: 1178px;
}
.plains1Space
{
    width: 577px;
    height: 300px;
    top: 33px;
    left: 1754px;
}
.woods1Space
{
    width: 570px;
    height: 300px;
    top: 33px;
    left: 2331px;
}
.plains2Space
{
    width: 585px;
    height: 300px;
    top: 33px;
    left: 2901px;
}
.tavernSpace
{
    width: 570px;
    height: 315px;
    top: 33px;
    left: 3486px;
}
.fields2Space
{
    width: 450px;
    height: 288px;
    top: 348px;
    left: 3605px;
}
.ruinsSpace
{
    width: 450px;
    height: 272px;
    top: 634px;
    left: 3605px;
}
.plains3Space
{
    width: 450px;
    height: 272px;
    top: 906px;
    left: 3605px;
}
.forest3Space
{
    width: 450px;
    height: 272px;
    top: 1178px;
    left: 3605px;
}
.fields3Space
{
    width: 450px;
    height: 272px;
    top: 1450px;
    left: 3605px;
}
.villageSpace
{
    width: 568px;
    height: 280px;
    top: 1735px;
    left: 3485px;
}
.fields4Space
{
    width: 586px;
    height: 280px;
    top: 1735px;
    left: 2901px;
}
.graveyardSpace
{
    width: 575px;
    height: 280px;
    top: 1735px;
    left: 2328px;
}
.woods2Space
{
    width: 575px;
    height: 280px;
    top: 1735px;
    left: 1756px;
}
.sentinelSpace
{
    width: 575px;
    height: 280px;
    top: 1735px;
    left: 1181px;
}
.hills2Space
{
    width: 585px;
    height: 280px;
    top: 1735px;
    left: 598px;
}
.chapelSpace
{
    width: 555px;
    height: 280px;
    top: 1735px;
    left: 45px;
}
.fields5Space
{
    width: 405px;
    height: 285px;
    top: 1450px;
    left: 45px;
}
.cragsSpace
{
    width: 405px;
    height: 272px;
    top: 1179px;
    left: 45px;
}
.plains4Space
{
    width: 405px;
    height: 290px;
    top: 890px;
    left: 45px;
}
.woods3Space
{
    width: 405px;
    height: 260px;
    top: 630px;
    left: 45px;
}
.fields6Space
{
    width: 405px;
    height: 260px;
    top: 380px;
    left: 45px;
}
/* MIDDLE RING */
.warlocksCaveSpace
{
    width: 618px;
    height: 291px;
    top: 356px;
    left: 448px;
}
.desert1Space
{
    width: 645px;
    height: 291px;
    top: 356px;
    left: 1066px;
}
.oasisSpace
{
    width: 675px;
    height: 291px;
    top: 356px;
    left: 1710px;
}
.desert2Space
{
    width: 645px;
    height: 291px;
    top: 356px;
    left: 2380px;
}
.templeSpace
{
    width: 580px;
    height: 291px;
    top: 356px;
    left: 3022px;
}
.woodsSpace
{
    width: 410px;
    height: 250px;
    top: 650px;
    left: 3205px;
}
.runes1Space
{
    width: 410px;
    height: 280px;
    top: 900px;
    left: 3205px;
}
.castleSpace
{
    width: 410px;
    height: 270px;
    top: 1180px;
    left: 3205px;
}
.portalOfPowerSpace
{
    width: 590px;
    height: 270px;
    top: 1445px;
    left: 3025px;
}
.blackKnightSpace
{
    width: 640px;
    height: 270px;
    top: 1445px;
    left: 2385px;
}
.hiddenValleySpace
{
    width: 675px;
    height: 270px;
    top: 1445px;
    left: 1710px;
}
.hillsSpace
{
    width: 645px;
    height: 270px;
    top: 1445px;
    left: 1065px;
}
.cursedGladeSpace
{
    width: 625px;
    height: 270px;
    top: 1445px;
    left: 445px;
}
.runes2Space
{
    width: 425px;
    height: 270px;
    top: 1180px;
    left: 445px;
}
.chasmSpace
{
    width: 425px;
    height: 270px;
    top: 910px;
    left: 445px;
}
.runes3Space
{
    width: 425px;
    height: 270px;
    top: 650px;
    left: 445px;
}

/* INNER RING */

.valleyOfFireSpace
{
    width: 765px;
    height: 250px;
    top: 650px;
    left: 895px;
}
.werewolfDenSpace
{
    width: 785px;
    height: 250px;
    top: 650px;
    left: 1660px;
}
.deathSpace
{
    width: 755px;
    height: 250px;
    top: 650px;
    left: 2445px;
}
.cryptSpace
{
    width: 410px;
    height: 280px;
    top: 900px;
    left: 2790px;
}
.plainOfPerilSpace
{
    width: 760px;
    height: 245px;
    top: 1180px;
    left: 2440px;
}
.minesSpace
{
    width: 785px;
    height: 245px;
    top: 1180px;
    left: 1660px;
}
.vampiresTowerSpace
{
    width: 765px;
    height: 245px;
    top: 1180px;
    left: 895px;
}
.pitsSpace
{
    width: 350px;
    height: 280px;
    top: 900px;
    left: 895px;
}
.crownOfCommandSpace
{
    width: 1550px;
    height: 280px;
    top: 900px;
    left: 1240px;
}

/* CITY BOARD */
.cityGateSpace
{
     width: 405px;
    height: 330px;
       top: 574px;
      left: 725px;
}
.citySquareOfKingsSpace
{
     width: 400px;
    height: 235px;
       top: 930px;
      left: 705px;
}
.cityRoyalLaneSpace
{
     width: 400px;
    height: 230px;
       top: 1165px;
      left: 705px;
}
.citySouthSideAlleySpace
{
     width: 400px;
    height: 360px;
       top: 1390px;
      left: 705px;
}
.citySanctuarySquareSpace
{
     width: 280px;
    height: 360px;
       top: 1390px;
      left: 425px;
}
.citySanctuarySquareSpace
{
     width: 280px;
    height: 360px;
       top: 1390px;
      left: 425px;
}
.cityHighTempleSpace
{
     width: 375px;
    height: 360px;
       top: 1390px;
      left: 50px;
}
.cityNobleStreetSpace
{
     width: 280px;
    height: 225px;
       top: 1170px;
      left: 425px;
}
.cityAcademySpace
{
     width: 375px;
    height: 225px;
       top: 1170px;
      left: 50px;
}
.cityFlaskStreetSpace
{
     width: 280px;
    height: 230px;
       top: 935px;
      left: 425px;
}
.cityApothecarySpace
{
     width: 375px;
    height: 225px;
       top: 940px;
      left: 50px;
}
.citySorcererSquareSpace
{
     width: 280px;
    height: 265px;
       top: 665px;
      left: 425px;
}
.cityElementalAvenueSpace
{
     width: 280px;
    height: 265px;
       top: 665px;
      left: 425px;
}
.citySorcererSquareSpace
{
     width: 380px;
    height: 265px;
       top: 665px;
      left: 50px;
}
.cityTownSquareSpace
{
     width: 370px;
    height: 315px;
       top: 345px;
      left: 425px;
}
.cityMagicEmporiumSpace
{
     width: 370px;
    height: 265px;
       top: 400px;
      left: 50px;
}
.cityJailSpace
{
     width: 410px;
    height: 360px;
       top: 45px;
      left: 50px;
}
.citySoothsayerSpace
{
     width: 335px;
    height: 300px;
       top: 45px;
      left: 460px;
}
.cityGuildStreetSpace
{
     width: 305px;
    height: 215px;
       top: 345px;
      left: 795px;
}
.cityArmourySpace
{
     width: 305px;
    height: 300px;
       top: 45px;
      left: 795px;
}
.cityRatsRoadSpace
{
     width: 315px;
    height: 215px;
       top: 345px;
      left: 1100px;
}
.cityMenagerieSpace
{
     width: 315px;
    height: 300px;
       top: 45px;
      left: 1100px;
}
.cityDroppingsLaneSpace
{
     width: 290px;
    height: 215px;
       top: 345px;
      left: 1415px;
}
.cityStablesSpace
{
     width: 290px;
    height: 300px;
       top: 45px;
      left: 1415px;
}
.cityStablesSpace
{
     width: 290px;
    height: 300px;
       top: 45px;
      left: 1415px;
}
.cityBeggarsRowSpace
{
     width: 300px;
    height: 215px;
       top: 345px;
      left: 1710px;
}
.cityWharfSpace
{
     width: 300px;
    height: 300px;
       top: 45px;
      left: 1710px;
}
.cityThievesAlleySpace
{
     width: 495px;
    height: 215px;
       top: 345px;
      left: 2010px;
}
.cityRoguesGuildSpace
{
     width: 495px;
    height: 300px;
       top: 45px;
      left: 2010px;
}
.cityNorthSideAlleySpace
{
     width: 495px;
    height: 320px;
       top: 560px;
      left: 2010px;
}
.cityCobbleLaneSpace
{
     width: 300px;
    height: 320px;
       top: 560px;
      left: 1710px;
}
.cityGoldStreetSpace
{
     width: 290px;
    height: 320px;
       top: 560px;
      left: 1415px;
}
.citySpeakersCornerSpace
{
     width: 270px;
    height: 320px;
       top: 560px;
      left: 1145px;
}

/* DUNGEON BOARD */
.dungeonEntranceSpace
{
     width: 360px;
    height: 260px;
       top: 1490px;
      left: 1425px;
}
.dungeonCorridor1Space
{
     width: 360px;
    height: 270px;
       top: 1220px;
      left: 1425px;
}
.dungeonTunnel1Space
{
     width: 360px;
    height: 270px;
       top: 950px;
      left: 1425px;
}
.dungeonLibrarySpace
{
     width: 365px;
    height: 340px;
       top: 605px;
      left: 1420px;
}
.dungeonCavern1Space
{
     width: 340px;
    height: 275px;
       top: 605px;
      left: 1075px;
}
.dungeonCorridor2Space
{
     width: 340px;
    height: 275px;
       top: 605px;
      left: 735px;
}
.dungeonGuardRoomSpace
{
     width: 340px;
    height: 275px;
       top: 605px;
      left: 390px;
}
.dungeonTunnel2Space
{
     width: 335px;
    height: 275px;
       top: 605px;
      left: 55px;
}
.dungeonCavern2Space
{
     width: 335px;
    height: 245px;
       top: 355px;
      left: 55px;
}
.dungeonCorridor3Space
{
     width: 340px;
    height: 245px;
       top: 355px;
      left: 390px;
}
.dungeonCellSpace
{
     width: 340px;
    height: 245px;
       top: 355px;
      left: 735px;
}
.dungeonTunnel3Space
{
     width: 340px;
    height: 245px;
       top: 355px;
      left: 1080px;
}
.dungeonVault1Space
{
     width: 305px;
    height: 245px;
       top: 355px;
      left: 1420px;
}
.dungeonHallOfDarknessSpace
{
     width: 375px;
    height: 320px;
       top: 355px;
      left: 1725px;
}
.dungeonHallOfDarknessSpace
{
     width: 375px;
    height: 320px;
       top: 355px;
      left: 1725px;
}
.dungeonTunnel4Space
{
     width: 315px;
    height: 270px;
       top: 675px;
      left: 1785px;
}
.dungeonCorridor4Space
{
     width: 315px;
    height: 270px;
       top: 950px;
      left: 1785px;
}
.dungeonKitchenSpace
{
     width: 315px;
    height: 270px;
       top: 1220px;
      left: 1785px;
}
.dungeonCavern3Space
{
     width: 315px;
    height: 260px;
       top: 1490px;
      left: 1785px;
}
.dungeonCorridor5Space
{
     width: 405px;
    height: 260px;
       top: 1490px;
      left: 2100px;
}
.dungeonTunnel5Space
{
     width: 405px;
    height: 270px;
       top: 1220px;
      left: 2100px;
}
.dungeonTortureChamberSpace
{
     width: 405px;
    height: 270px;
       top: 950px;
      left: 2100px;
}
.dungeonVault2Space
{
     width: 405px;
    height: 270px;
       top: 680px;
      left: 2100px;
}
.dungeonCorridor6Space
{
     width: 405px;
    height: 255px;
       top: 420px;
      left: 2100px;
}
.dungeonMonsterPitSpace
{
     width: 455px;
    height: 375px;
       top: 45px;
      left: 2050px;
}
.dungeonTunnel6Space
{
     width: 325px;
    height: 310px;
       top: 45px;
      left: 1725px;
}
.dungeonCavern4Space
{
     width: 305px;
    height: 310px;
       top: 45px;
      left: 1420px;
}
.dungeonSummoningCircleSpace
{
     width: 485px;
    height: 310px;
       top: 45px;
      left: 930px;
}
.dungeonVault3Space
{
     width: 345px;
    height: 310px;
       top: 45px;
      left: 580px;
}
.dungeonTresureChamberSpace
{
     width: 520px;
    height: 310px;
       top: 45px;
      left: 60px;
}

/* WOODLAND BOARD */
.woodlandEntranceSpace
{
     width: 370px;
    height: 295px;
       top: 35px;
      left: 1420px;
}
.woodlandWoods1Space
{
     width: 370px;
    height: 265px;
       top: 335px;
      left: 1420px;
}
.woodlandGlade1Space
{
     width: 370px;
    height: 265px;
       top: 595px;
      left: 1420px;
}
.woodlandFaerieRingSpace
{
     width: 370px;
    height: 340px;
       top: 864px;
      left: 1420px;
}
.woodlandThicket1Space
{
     width: 315px;
    height: 260px;
       top: 945px;
      left: 1105px;
}
.woodlandWoods2Space
{
     width: 335px;
    height: 260px;
       top: 945px;
      left: 770px;
}
.woodlandWitchTreeSpace
{
     width: 335px;
    height: 260px;
       top: 945px;
      left: 432px;
}
.woodlandGlade2Space
{
     width: 380px;
    height: 260px;
       top: 945px;
      left: 50px;
}
.woodlandThicket2Space
{
     width: 380px;
    height: 240px;
       top: 1205px;
      left: 50px;
}
.woodlandWoods3Space
{
     width: 340px;
    height: 240px;
       top: 1205px;
      left: 430px;
}
.woodlandCrossroadsSpace
{
     width: 335px;
    height: 240px;
       top: 1205px;
      left: 770px;
}
.woodlandGlade3Space
{
     width: 335px;
    height: 240px;
       top: 1205px;
      left: 1105px;
}
.woodlandDenseForestSpace
{
     width: 300px;
    height: 240px;
       top: 1205px;
      left: 1440px;
}
.woodlandSwamplandSpace
{
     width: 365px;
    height: 315px;
       top: 1130px;
      left: 1740px;
}
.woodlandGlade4Space
{
     width: 305px;
    height: 265px;
       top: 865px;
      left: 1800px;
}
.woodlandWoods4Space
{
     width: 305px;
    height: 265px;
       top: 595px;
      left: 1800px;
}
.woodlandBog1Space
{
     width: 305px;
    height: 265px;
       top: 330px;
      left: 1800px;
}
.woodlandThicket3Space
{
     width: 305px;
    height: 295px;
       top: 35px;
      left: 1800px;
}
.woodlandFaerieVillage1Space
{
     width: 405px;
    height: 295px;
       top: 35px;
      left: 2110px;
}
.woodlandGlade5Space
{
     width: 405px;
    height: 260px;
       top: 335px;
      left: 2110px;
}
.woodlandBlastedHeathSpace
{
     width: 405px;
    height: 260px;
       top: 600px;
      left: 2110px;
}
.woodlandDenseForest1Space
{
     width: 405px;
    height: 260px;
       top: 865px;
      left: 2110px;
}
.woodlandFaerieVillage2Space
{
     width: 405px;
    height: 250px;
       top: 1130px;
      left: 2110px;
}
.woodlandMysticGlenSpace
{
     width: 450px;
    height: 370px;
       top: 1385px;
      left: 2065px;
}
.woodlandMysticGlenSpace
{
     width: 450px;
    height: 370px;
       top: 1385px;
      left: 2065px;
}
.woodlandBog2Space
{
     width: 320px;
    height: 310px;
       top: 1445px;
      left: 1740px;
}
.woodlandThicket4Space
{
     width: 300px;
    height: 310px;
       top: 1445px;
      left: 1440px;
}
.woodlandMabsLairSpace
{
     width: 480px;
    height: 310px;
       top: 1445px;
      left: 960px;
}
.woodlandDenseForest2Space
{
     width: 340px;
    height: 310px;
       top: 1445px;
      left: 620px;
}
.woodlandMeetingWithDestinySpace
{
     width: 570px;
    height: 310px;
       top: 1445px;
      left: 50px;
}



/* HIGHLAND BOARD */
.highlandEntranceSpace
{
     width: 300px;
    height: 300px;
       top: 45px;
      left: 815px;
}
.highlandHills1Space
{
     width: 300px;
    height: 265px;
       top: 345px;
      left: 815px;
}
.highlandCliff1Space
{
     width: 300px;
    height: 265px;
       top: 605px;
      left: 815px;
}
.highlandRidgewaySpace
{
     width: 300px;
    height: 330px;
       top: 870px;
      left: 815px;
}
.highlandRavine1Space
{
     width: 325px;
    height: 255px;
       top: 945px;
      left: 1115px;
}
.highlandHills2Space
{
     width: 330px;
    height: 255px;
       top: 945px;
      left: 1440px;
}
.highlandRuinedMineSpace
{
     width: 330px;
    height: 255px;
       top: 945px;
      left: 1770px;
}
.highlandCliff2Space
{
     width: 410px;
    height: 255px;
       top: 945px;
      left: 2105px;
}
.highlandRavine2Space
{
     width: 410px;
    height: 230px;
       top: 1205px;
      left: 2105px;
}
.highlandHills3Space
{
     width: 330px;
    height: 230px;
       top: 1205px;
      left: 1770px;
}
.highlandGlacierSpace
{
     width: 330px;
    height: 230px;
       top: 1205px;
      left: 1440px;
}
.highlandCliff3Space
{
     width: 325px;
    height: 230px;
       top: 1205px;
      left: 1115px;
}
.highlandCanyon1Space
{
     width: 295px;
    height: 230px;
       top: 1205px;
      left: 820px;
}
.highlandMountainPassSpace
{
     width: 360px;
    height: 305px;
       top: 1130px;
      left: 455px;
}
.highlandCliff4Space
{
     width: 360px;
    height: 260px;
       top: 870px;
      left: 455px;
}
.highlandHills4Space
{
     width: 360px;
    height: 265px;
       top: 605px;
      left: 455px;
}
.highlandPrecipice1Space
{
     width: 360px;
    height: 255px;
       top: 350px;
      left: 455px;
}
.highlandRavine3Space
{
     width: 360px;
    height: 300px;
       top: 45px;
      left: 455px;
}
.highlandHills5Space
{
     width: 395px;
    height: 300px;
       top: 45px;
      left: 60px;
}
.highlandCanyon2Space
{
     width: 395px;
    height: 260px;
       top: 345px;
      left: 60px;
}
.highlandCliff5Space
{
     width: 395px;
    height: 265px;
       top: 345px;
      left: 60px;
}
.highlandWaterfallSpace
{
     width: 395px;
    height: 265px;
       top: 605px;
      left: 60px;
}
.highlandWaterfallSpace
{
     width: 395px;
    height: 265px;
       top: 605px;
      left: 60px;
}
.highlandCanyon2Space
{
     width: 395px;
    height: 260px;
       top: 870px;
      left: 60px;
}
.highlandCliff6Space
{
     width: 395px;
    height: 245px;
       top: 1130px;
      left: 60px;
}
.highlandLostCitySpace
{
     width: 445px;
    height: 365px;
       top: 1380px;
      left: 60px;
}
.highlandPrecipice2Space
{
     width: 310px;
    height: 310px;
       top: 1435px;
      left: 505px;
}
.highlandRavine4Space
{
     width: 300px;
    height: 310px;
       top: 1435px;
      left: 815px;
}
.highlandIceBridgeSpace
{
     width: 470px;
    height: 310px;
       top: 1435px;
      left: 1115px;
}
.highlandCanyon3Space
{
     width: 330px;
    height: 310px;
       top: 1435px;
      left: 1585px;
}
.highlandEyrieSpace
{
     width: 590px;
    height: 310px;
       top: 1435px;
      left: 1915px;
}

/* DEEPREALM BORAD */
.deeprealmOldSewerSpace
{
     width: 325px;
    height: 315px;
        top: 35px;
       left: 20px;
}
.deeprealmRatsNestSpace
{
    width: 270px;
   height: 315px;
       top: 35px;
      left: 345px;
}
.deeprealmThroneRoom
{
    width: 270px;
   height: 315px;
       top: 35px;
      left: 665px;
}
.deeprealmCatacombsSpace
{
    width: 320px;
   height: 315px;
       top: 35px;
      left: 940px;
}
.deeprealmRatRunSpace
{
    width: 620px;
   height: 280px;
      top: 355px;
      left: 20px;
}
.deeprealmSkullPassageSpace
{
    width: 620px;
   height: 280px;
      top: 355px;
      left: 640px;
}

/* SPACE HIHGLIGHT */
.highlight
{
    opacity: 0.0;
    transition: opacity 0.3s ease-in-out;
    animation: fadeOut 0.5s;
    width: 100%;
    height: 100%;
    z-index: 5;
    pointer-events: none;
    position: absolute;
}
.topLeftHighlight
{
    background-image: url(assets/board/glow/tl.png);
    background-position: center;
    background-size: 100% 100%;
    width: 100px;
    height: 100px;
    top: 0px;
    left: 0px;
    position: inherit;
}
.topHighlight
{
    background-image: url(assets/board/glow/t.png);
    background-position: center;
    background-size: 100% 100%;
    width: calc(100% - 200px);
    height: 100px;
    top: 0px;
    left: 100px;
    position: inherit;
}
.topRightHighlight
{
    background-image: url(assets/board/glow/tr.png);
    background-position: center;
    background-size: 100% 100%;
    width: 100px;
    height: 100px;
    top: 0px;
    right: 0px;
    position: inherit;
}
.rightHighlight
{
    background-image: url(assets/board/glow/r.png);
    background-position: center;
    background-size: 100% 100%;
    width: 100px;
    height: calc(100% - 200px);
    top: 100px;
    right: 0px;
    position: inherit;
}
.bottomRightHighlight
{
    background-image: url(assets/board/glow/br.png);
    background-position: center;
    background-size: 100% 100%;
    width: 100px;
    height: 100px;
    bottom: 0px;
    right: 0px;
    position: inherit;
}
.bottomHighlight
{
    background-image: url(assets/board/glow/b.png);
    background-position: center;
    background-size: 100% 100%;
    width: calc(100% - 200px);
    height: 100px;
    bottom: 0px;
    right: 100px;
    position: inherit;
}
.bottomLeftHighlight
{
    background-image: url(assets/board/glow/bl.png);
    background-position: center;
    background-size: 100% 100%;
    width: 100px;
    height: 100px;
    bottom: 0px;
    left: 0px;
    position: inherit;
}
.LeftHighlight
{
    background-image: url(assets/board/glow/l.png);
    background-position: center;
    background-size: 100% 100%;
    width: 100px;
    height: calc(100% - 200px);
    bottom: 100px;
    left: 0px;
    position: inherit;
}

/* UI */
.cityDrawer
{
    position: absolute;
    width: 1024px;
    height: 1024px;
    top: 4px;
    left: 768px;
    transition: top 0.5s ease-out;
    background-image: url(assets/ui/paper02.png);
    background-size: 100% 100%;
    background-repeat: no-repeat;
    pointer-events: all;
}
.cityDrawer:hover .cityDrawerArrow
{
    top: -128px;
}
.cityDrawerArrow
{
    position: absolute;
    left: 398px;
    top: -96px;
    width: 228px;
    height: 128px;
    transition: top 0.75s ease-out;
    background-image: url(assets/ui/dropmenu_arrow_up.png);
    background-size: 100% 100%;
    background-repeat: no-repeat;
}
.dungeonDrawer
{
    position: absolute;
    width: 1024px;
    height: 1024px;
    top: 4px;
    right: 768px;
    transition: top 0.5s ease-out;
    background-image: url(assets/ui/paper02.png);
    background-size: 100% 100%;
    background-repeat: no-repeat;
    pointer-events: all;
}
.dungeonDrawer:hover .dungeonDrawerArrow
{
    top: -128px;
}
.dungeonDrawerArrow
{
    position: absolute;
    left: 398px;
    top: -96px;
    width: 228px;
    height: 128px;
    transition: top 0.75s ease-out;
    background-image: url(assets/ui/dropmenu_arrow_up.png);
    background-size: 100% 100%;
    background-repeat: no-repeat;
}
.woodlandDrawer:hover .woodlandDrawerArrow
{
    bottom: -128px;
}
.woodlandDrawer
{
    position: absolute;
    width: 1024px;
    height: 384px;
    bottom: 16px;
    right: 768px;
    padding-top: 64px;
    transition: bottom 0.5s ease-out;
    background-image: url(assets/ui/paper02.png);
    background-size: 100% 267%;
    background-position: 100% 100%;
    background-repeat: no-repeat;
    pointer-events: all;
}
.woodlandDrawerArrow
{
    position: absolute;
    left: 398px;
    bottom: -103px;
    width: 228px;
    height: 128px;
    transition: bottom 0.75s ease-out;
    background-image: url(assets/ui/dropmenu_arrow_up.png);
    transform: scaleY(-1);
    background-size: 100% 100%;
    background-repeat: no-repeat;
}
.highlandDrawer
{
    position: absolute;
    width: 1024px;
    height: 1024px;
    bottom: 16px;
    left: 768px;
    transition: bottom 0.5s ease-out;
    background-image: url(assets/ui/paper02.png);
    background-size: 100% 100%;
    background-repeat: no-repeat;
    pointer-events: all;
}
.highlandDrawer:hover .highlandDrawerArrow
{
    bottom: -128px;
}
.highlandDrawerArrow
{
    position: absolute;
    left: 398px;
    bottom: -96px;
    width: 228px;
    height: 128px;
    transition: bottom 0.75s ease-out;
    background-image: url(assets/ui/dropmenu_arrow_up.png);
    transform: scaleY(-1);
    background-size: 100% 100%;
    background-repeat: no-repeat;
}

/* DRAWER DECKS */
.deckIcon
{
    margin: 8px;
    position: relative;
    width: 240px;
    height: 320px;
    background-size: 100% 85%;
    background-repeat: no-repeat;
    background-position: 100% 100%;
    font-family: Windlass;
    color: white;
    text-align: center;
    letter-spacing: 2px;
    font-size: 32px;
    cursor: pointer;
    transition: background-color 0.3s ease-in-out;
    display: inline-block;
    border-radius: 10px;
}
.deckIcon:hover { background-color: #fff3; }
.upperDeck { transform: rotate(180deg); }

.cityDrawer.upperDrawer:hover { top: -708px; }
.cityDeck { background-image: url(assets/cards/city_card_button.png); }
.wantedDeck { background-image: url(assets/cards/wanted_card_button.png); }
.petsDeck { background-image: url(assets/cards/pet_card_button.png); }
.armouryDeck { background-image: url(assets/cards/armoury_card_button.png); }
.potionsDeck { background-image: url(assets/cards/potion_card_button.png); }
.emporiumDeck { background-image: url(assets/cards/emporium_card_button.png); }
.stablesDeck { background-image: url(assets/cards/stables_card_button.png); }
.spellsDeck { background-image: url(assets/cards/spells_card_button.png); }

.dungeonDrawer.upperDrawer:hover { top: -384px; }
.dungeonDeck { background-image: url(assets/cards/dungeon_card_button.png); }
.treasureDeck { background-image: url(assets/cards/treasure_card_button.png); }

.lowerDeck { margin-top: 32px; }
.woodlandDrawer.bottomDrawer:hover { bottom: -368px; }
.woodlandDeck { background-image: url(assets/cards/woodland_card_button.png); }
.pathDeck { background-image: url(assets/cards/path_card_button.png); }
.destinyDeck { background-image: url(assets/cards/destiny_card_button.png); }


/* .bottomDrawer:hover
{
    bottom: -1010px;
} */

/* CHARACTER SHEET CONTAINER */

.characterSheetContainer
{
    position: absolute;
    bottom: 38px;
    left: 2560px;
    width: 1236px;
    height: 800px;
    background-image: url(assets/ui/card_template.png);
    background-size: 100% 100%;
    background-repeat: no-repeat;
    position: absolute;
}
.characterSheetContainer div span
{
    font-weight: 900;
}
.characterSheetName
{
    font-family: Windlass;
    top: 34px;
    left: 386px;
    font-size: 32px;
    height: 52px;
    width: 453px;
    text-align: center;
    line-height: 56px;
    position: absolute;
    letter-spacing: 2px;
}
.characterSheetStrength
{
    font-family: Caxton;
    font-weight: 800;
    top: 196px;
    left: -18px;
    font-size: 32px;
    height: 96px;
    width: 96px;
    text-align: center;
    line-height: 120px;
    cursor: pointer;
    background-image: url(assets/ui/strength_token.png);
    background-size: 100% 100%;
    background-repeat: no-repeat;
    color: transparent;
    text-shadow: 0 0 0.1vw #f1abab;
    position: absolute;
}
.characterSheetCraft
{
    font-family: Caxton;
    font-weight: 800;
    top: 340px;
    left: -18px;
    font-size: 32px;
    height: 96px;
    width: 96px;
    text-align: center;
    line-height: 120px;
    cursor: pointer;
    background-image: url(assets/ui/craft_token.png);
    background-size: 100% 100%;
    background-repeat: no-repeat;
    color: transparent;
    text-shadow: 0 0 0.1vw #a2e2f5;
    position: absolute;
}
.characterSheetFateLight
{
    font-family: Caxton;
    font-weight: 800;
    top: 196px;
    left: 1108px;
    font-size: 32px;
    height: 128px;
    width: 128px;
    text-align: center;
    line-height: 128px;
    cursor: pointer;
    background-image: url(assets/ui/fate_light_token.png);
    background-size: 100% 100%;
    background-repeat: no-repeat;
    color: transparent;
    position: absolute;
    text-shadow: 0 0 0.1vw #d9cfc4;

}
.characterSheetFateDark
{
    font-family: Caxton;
    font-weight: 800;
    top: 336px;
    left: 1108px;
    font-size: 32px;
    height: 128px;
    width: 128px;
    text-align: center;
    line-height: 128px;
    cursor: pointer;
    background-image: url(assets/ui/fate_dark_token.png);
    background-size: 100% 100%;
    background-repeat: no-repeat;
    color: transparent;
    position: absolute;
    text-shadow: 0 0 0.1vw #938995;
}
.characterSheetLife
{
    font-family: Caxton;
    font-weight: 800;
    top: 490px;
    left: -18px;
    font-size: 32px;
    height: 96px;
    width: 96px;
    text-align: center;
    line-height: 120px;
    cursor: pointer;
    background-image: url(assets/ui/life_token.png);
    background-size: 100% 100%;
    background-repeat: no-repeat;
    color: transparent;
    text-shadow: 0 0 0.1vw #a2f39e;
    position: absolute;
}
.characterSheetCoin
{
    font-family: Caxton;
    font-weight: 800;
    top: 480px;
    left: 1138px;
    font-size: 32px;
    height: 96px;
    width: 96px;
    text-align: center;
    line-height: 100px;
    cursor: pointer;
    background-image: url(assets/ui/coin_token.png);
    background-size: 100% 100%;
    background-repeat: no-repeat;
    color: transparent;
    text-shadow: 0 0 0.1vw #392c02;
    position: absolute;
}
.charsheetMini
{
    top: 108px;
    left: 90px;
    height: 610px;
    width: 488px;
    background-image: url(assets/chars/alchemist_miniature.png);
    background-size: 100% 100%;
    background-repeat: no-repeat;
    display: inline-block;
    position: absolute;
}
.charsheetDescription
{
    top: 127px;
    left: 648px;
    height: 560px;
    width: 450px;
    font-family: Caxton;
    font-size: 24px;
    position: absolute;
}
.charsheetObjects
{
    font-family: Windlass;
    top: 729px;
    left: 226px;
    font-size: 24px;
    height: 32px;
    width: 225px;
    text-align: center;
    line-height: 36px;
    position: absolute;
    letter-spacing: 2px;
}
.charsheetFollowers
{
    font-family: Windlass;
    top: 729px;
    left: 770px;
    font-size: 24px;
    height: 32px;
    width: 225px;
    text-align: center;
    line-height: 36px;
    position: absolute;
    letter-spacing: 2px;
}

/* SPACE DESCRIPTION */
.spaceDescriptionContainer
{
    pointer-events: none;
    position: absolute;
    max-width: 800px;
    min-width: 800px;
    width: 100%;
    z-index: 15;
    font-family: Caxton;
    opacity: 0;
    transition: opacity 0.3s ease-out;
}
.spaceName
{
    font-size: 48px;
    height: 96px;
    width: 100%;
    max-width: 540px;
    text-align: center;
    line-height: 2;
    background-image: url(assets/ui/nameframe.png);
    background-size: 100% 100%;
    position: inherit;
}
.spaceDescription
{
    font-size: 32px;
    line-height: 1.5;
    top: 96px;
    padding: 24px 32px 48px 32px;
    width: calc(100% - 48px);
    min-height: 32px;
    height: auto;
    text-align: center;
    background-image: url(assets/ui/paper.png);
    background-size: 100% 100%;
    position: inherit;
}
.spaceDescriptionLine
{
    position: relative;
    margin: 24px 0px 0px 0px;
}
.spaceDescriptionRoll
{
    position: relative;
    margin: 0px;
}
.spaceDescriptionResult
{
    display: inline-block;
    position: relative;
    margin: 0px 16px 0px 16px;
}

.overlay
{
    top: 0px;
    left: 0px;
    position: absolute;
    width: 100%;
    height: 100%;
    z-index: 6;
    background-color: #00000037;
    cursor: pointer;
}
/* CONTEXT MENU */
.spaceMenu
{
    position: absolute;
    width: auto;
    height: auto;
    z-index: 7;
    user-select: none;
    cursor: pointer;
    background-color: #2d2e32;
    box-shadow: 3px 3px 5px 5px #0009;
    padding: 4px 0px 4px 0px;
}
.spaceMenuRow
{
    font-family: Caxton;
    color: #ffffff80;
    font-size: 18px;
    line-height: 1.5;
    border-radius: 2px;
    transition: background-color 0.3s ease-in-out, color 0.3s ease-in-out;
    padding: 0px 16px 0px 16px;
}
.spaceMenuDivide
{
    height: 9px;
}
.spaceMenuRow:hover
{
    color: #2d2e32;
    background-color: #ffffff80;
}
.spaceMenuDraw
{

}
.spaceMenuRoll
{

}
.spaceMenuShowCards
{

}
</style>
</head>
<body>

<div class="deckBar">
    <div class="deckBarArrow"></div>
    <div class="adventureDeck"></div>
    <div class="purchaseDeck"></div>
    <div class="spellsDeck"></div>
    <div class="beastsDeck"></div>
    <div class="beastRewardDeck"></div>
    <div class="denizenDeck"></div>
    <div class="remnantDeck"></div>
    <div class="terrainDeck"></div>
    <div class="warlockDeck"></div>

    <!-- CITY -->
    <div class="cityDeck"></div>
    <div class="armouryDeck"></div>
    <div class="emporiumDeck"></div>
    <div class="petsDeck"></div>
    <div class="potionsDeck"></div>
    <div class="stablesDeck"></div>
    <div class="wantedDeck"></div>

    <div class="materialDeck"></div>

    <!-- DEEP REALM -->
    <div class="bridgeDeck"></div>
    <div class="tunnelDeck"></div>


    <div class="draconicLordsDeck"></div>
    <div class="cadorusDeck"></div>
    <div class="grilipusDeck"></div>
    <div class="varthraxDeck"></div>

    <!-- DUNGEON -->
    <div class="treasureDeck"></div>

    <!-- HIGHLAND -->
    <div class="relicDeck"></div>
    <div class="highlandDeck"></div>

    <div class="armageddonOmenDeck"></div>
    <div class="deadOmenDeck"></div>
    <div class="shatteredOmenDeck"></div>
    <div class="starsOmenDeck"></div>
    <div class="harbingerDeck"></div>
    <div class="netherDeck"></div>
    <div class="questRewardsDeck"></div>
    <div class="spiritDeck"></div>

    <!-- WOODLAND -->
    <div class="destinyDeck"></div>
    <div class="pathDeck"></div>
    <div class="woodlandDeck"></div>
</div>
<div id="gameContainer"></div>
</body>
<!-- TODO merge game data into single json -->
<!-- <script src="assets/text/expansions.js"></script>
<script src="assets/text/chars.js"></script> -->
<!-- <script src="assets/text/base_spaces.js"></script>
<script src="assets/text/cards.js"></script> -->
<script>
/* DECLARES */
let chars;
let cards;
let spaces;
let cardPool = {};
let spaceCards = {};

function fetch(url, type)
{
    return new Promise((resolve, reject)=>
    {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", url, true);

        if (type)
            xhr.responseType = type;

        xhr.addEventListener("load", function ()
        {
            if (xhr.status !== 200)
                resolve(false);
            else
                resolve(xhr.response);

        }, false);
        xhr.send();
    });
}
var storage = {};

function storageInit(db, storeList)
{
    let indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;
    let dbRequest = indexedDB.open(db);

    dbRequest.onupgradeneeded = function(event)
    {
        let db = event.target.result;
        storeList.forEach(function(store)
        {
            if (!db.objectStoreNames.contains(store))
                db.createObjectStore(store);
        });
        db.close();
    }
}

function storageDisconnect(db)
{
    return new Promise(resolve =>
    {
        storage[db].close();
        delete storage[db];
        resolve();
    });
}

function storageConnect(db, version)
{
    return new Promise(function(resolve, reject)
    {
        try
        {
            let indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;

            if (db in storage)
                resolve(storage[db]); //do not connect if already connected

            let dbRequest;
            if (version)
                dbRequest = indexedDB.open(db, version);
            else
                dbRequest = indexedDB.open(db);

            dbRequest.onerror = function(event)
            {
                console.log(event);
                reject(event);
            };

            dbRequest.onsuccess = function(event)
            {
                storage[db] = event.target.result;
                resolve(true);
            };
        }
        catch (error)
        {
            console.log(error);
            reject(error);
        }
    });
}

function storageExists(cmd)
{
    return new Promise(function(resolve, reject)
    {
        try
        {
            let db = storage[cmd.dbName];
            let nameExists = db.objectStoreNames.contains(cmd.store);
            if (nameExists)
            {
                let transaction = db.transaction([cmd.store], 'readwrite');
                let objectStore = transaction.objectStore(cmd.store);
                let objectRequest = objectStore.get(cmd.name);

                objectRequest.onerror = function(event)
                {
                    console.log(event);
                    resolve(false);
                };

                objectRequest.onsuccess = function(event)
                {
                    resolve(event.target.result ? true : false);
                };
            }

        }
        catch (error)
        {
            console.log(error);
            reject(error);
        }
    });
}

function storageGet(cmd)
{
    return new Promise(function(resolve, reject)
    {
        let transaction;
        try
        {
            transaction = storage[cmd.dbName].transaction([cmd.store], 'readonly');
        }
        catch (error)
        {
            console.log(error);
            if (!transaction)
            {
                resolve(event);
            }
        }
        finally
        {
            let objectStore = transaction.objectStore(cmd.store);
            let objectRequest = objectStore.get(cmd.name); // Overwrite if exists

            objectRequest.onerror = function(event)
            {
                console.log(event);
                resolve(event);
            };

            objectRequest.onsuccess = function(event)
            {
                resolve(objectRequest.result);
            };
        }
    });
}

function storagePut(cmd)
{
    return new Promise(async function(resolve, reject)
    {
        let transaction = storage[cmd.dbName].transaction([cmd.store], 'readwrite');
        let objectStore = transaction.objectStore(cmd.store);
        let objectRequest = objectStore.put(cmd.data, cmd.name);

        objectRequest.onerror = function(event)
        {
            reject(event);
        };

        objectRequest.onsuccess = function(event)
        {
            resolve(event.target.result);
        };
    });
}

function storageRemove(cmd)
{
    return new Promise(async function(resolve, reject)
    {
        let transaction = storage[cmd.dbName].transaction([cmd.store], 'readwrite');
        let objectStore = transaction.objectStore(cmd.store);
        let objectRequest = objectStore.delete(cmd.name);

        objectRequest.onerror = function(event)
        {
            reject(event);
        };

        objectRequest.onsuccess = function(event)
        {
            resolve(event.target.result);
        };
    });
}

/* GAME MAP */
let dragging;
let spaceClickDisabled;
let zoomDisabled;
let rotating;
let gameMap;
let gameMapInner;
let characterSheetContainer;
let computedStyle;
let innerWidth;
let innerHeight;
let transform;
function setTransform()
{
    gameMapInner.style.setProperty("transform", "translate3d(" + transform.translate[0] + "px," + transform.translate[1] + "px, 0px) scale(" + transform.scale + ") rotate(" + transform.rotate + "deg)");
}

function capMovement()
{
    if (transform.translate[0] > 256)
        transform.translate[0] = 256;
    if (transform.translate[0] < -5242)
        transform.translate[0] = -5242;
    if (transform.translate[1] > 1024)
        transform.translate[1] = 1024;
    if (transform.translate[1] < -3706)
        transform.translate[1] = -3706;
}

function moveMap(event)
{
    transform.translate[0] += event.movementX * (1 + (transform.scale - 0.4));
    transform.translate[1] += event.movementY * (1 + (transform.scale - 0.4));
}
function rotateMap(event)
{
    let x = event.clientX; //x position in viewport
    let y = event.clientY;  //y position in viewport
    let center = {x: (window.innerWidth)/2, y: (window.innerHeight) /2};
    let translateDelta = {x: x - center.x, y: y - center.y};

    if (translateDelta.x < 0)
        transform.rotate += (event.movementY * -1) * 0.2;
    else
        transform.rotate += event.movementY * 0.2;

    if (translateDelta.y < 0)
        transform.rotate += event.movementX * 0.2;
    else
        transform.rotate += event.movementX * -0.2;

    //reset rotate if exceeds single rotation
    if (transform.rotate > 360)
        transform.rotate -= 360;
    else if (transform.rotate < -360)
        transform.rotate += 360;

    setTransform();
}

function translateMap(event)
{
    if (!dragging)
        return;

    spaceClickDisabled = true;

    gameMapInner.style.setProperty("cursor", "grabbing");
    gameMapInner.style.setProperty("transition", "transform 0.0s linear");
    if (event.ctrlKey)
        rotateMap(event);
    else if (!event.ctrlKey)
        moveMap(event);

    capMovement();
    setTransform();
}

function wheelZoom(event)
{
    if (zoomDisabled)
        return;

    let scaleMin = 0.2;
    let scaleMax = 1;
    transform.scale += (event.deltaY * -0.0005);
    if (transform.scale < scaleMin)
        transform.scale = scaleMin;
    else if (transform.scale > scaleMax)
        transform.scale = scaleMax;

    let x = event.clientX; //x position in viewport
    let y = event.clientY;  //y position in viewport
    let center = {x: (window.innerWidth)/2, y: (window.innerHeight) /2};
    let translateDelta = {x: x - center.x, y: y - center.y};
    let deltaFraction = 0.2;

    if (transform.scale > scaleMin && transform.scale < scaleMax)
    {
        if (event.deltaY < 0) //if zoom in
            transform.translate[1] -= translateDelta.y * (deltaFraction * 1.5);
        else
            transform.translate[1] -= translateDelta.y * (deltaFraction);

        if (event.deltaY < 0)
            transform.translate[0] -= translateDelta.x * deltaFraction;
        else
            transform.translate[0] -= translateDelta.x * deltaFraction;

        capMovement();
    }
    gameMapInner.style.setProperty("transition", "transform 0.1s linear");
    setTransform();
}
document.addEventListener("wheel", wheelZoom); //set da event

// SPACE HANDLING
function closeContextMenu()
{
    let overlay = document.querySelector(".overlay");
    overlay.parentNode.removeChild(overlay);

    let spaceMenu = document.querySelector(".spaceMenu");
    spaceMenu.parentNode.removeChild(spaceMenu);

    zoomDisabled = false;
}

function spaceClick(event)
{
    if (spaceClickDisabled)
        return;

    let board = event.target.parentNode.getAttribute("Board");
    let space = event.target.getAttribute("space");

    if (!board || !space)
        return;

    zoomDisabled = true;

    let overlay = document.createElement("overlay");
    overlay.setAttribute("class", "overlay")
    overlay.addEventListener("click", closeContextMenu);
    document.body.appendChild(overlay);

    let spaceMenu = document.createElement("spaceMenu");
    spaceMenu.setAttribute("class", "spaceMenu");
    spaceMenu.setAttribute("space", event.target.classList[1]);

    //create context menu
    //move character here
    let moveChar = document.createElement("div");
    moveChar.className = "spaceMenuRow";
    moveChar.textContent = "Move here"
    spaceMenu.appendChild(moveChar);

    let dynamicOptions = document.createElement("div");
    //view cards

    spaces[board][space].forEach(function(line)
    {
        let menuRow = document.createElement("div");
        menuRow.className = "spaceMenuRow";

        if ("roll" in line) //if roll on space
        {
            menuRow.textContent = line.option;
            //roll die
            line.roll;
            //for each line.roll
            //for each line.roll[i].values
            //if int, if equal to roll, display message, append to log
            //if string, split +, parse to int, if greater than number, display message, append to log
            //
            dynamicOptions.appendChild(menuRow);
        }
        else if ("draw" in line) //if draw on space
        {
            menuRow.textContent = "Draw " + line.draw.deck + " card";
            //TODO if (line.draw.count > [cards on space])

            //TODO add draw cards event listener
            line.count;
            line.limit;
            line.deck;

            dynamicOptions.appendChild(menuRow);
        }
        else if ("browse" in line) //if select/buy on space
        {
            menuRow.textContent = "Browse " + line.browse.charAt(0).toUpperCase()
                                + line.browse.slice(1) + " deck";
            //TODO add view cards event listener

            dynamicOptions.appendChild(menuRow);
        }

    });

    //add divide bar
    if (dynamicOptions.children.length > 0)
    {
        let divideBar = document.createElement("div");
        divideBar.className = "spaceMenuDivide";
        spaceMenu.appendChild(divideBar);
    }
    spaceMenu.appendChild(dynamicOptions);

    if (event.target.classList[1] in spaceCards)
    {
        let displayCards = document.createElement("div");
        displayCards.className("spaceMenuRow");
        displayCards.textContent = "View cards";

        //TODO add view cards event listener

        spaceMenu.appendChild(displayCards);
    }

    //set menu position once all is appended
    document.body.appendChild(spaceMenu);

    let box = spaceMenu.getBoundingClientRect();
    if ((event.clientX + box.width) > window.innerWidth)
        spaceMenu.style.setProperty("left", event.clientX - box.width - 16);
    else
        spaceMenu.style.setProperty("left", event.clientX + 16);

    if ((event.clientY + box.height) > window.innerHeight)
        spaceMenu.style.setProperty("top", event.clientY - box.height - 16);
    else
        spaceMenu.style.setProperty("top", event.clientY + 16);
}

function createSpace(className, spaceName)
{
    var element = document.createElement("div");
    element.className = "space " + className;
    if (spaceName)
        element.setAttribute("space", spaceName);

    return element;
}

function removeMouseHoverElements(target)
{
    //remove space description
    target.removeAttribute("fading");

    target.querySelectorAll(".spaceDescriptionContainer").forEach(function(description)
    {
        description.parentNode.removeChild(description);
    });
    target.querySelectorAll(".highlight").forEach(function(highlight)
    {
        //remove highlight
        highlight.parentNode.removeChild(highlight);
    });
}

function createSpaceDescription(target, spaceBoard, spaceName)
{
    let space = spaces[spaceBoard][spaceName];
    for(let key in space)
    {
        let line = space[key];
        if ("description" in line)
        {
            let description = document.createElement("div");
            description.className = "spaceDescriptionLine";
            description.textContent = line.description;
            target.appendChild(description);
        }
        else if ("roll" in line)
        {
            let roll = document.createElement("div");
            roll.className = "spaceDescriptionRoll";

            line.roll.forEach(function(values)
            {
                let result = document.createElement("div");
                result.className = "spaceDescriptionResult";
                result.textContent = values.values.join(", ") + ") " + values.line;
                roll.appendChild(result);
            });
            target.appendChild(roll);
        }
    }
}

function shuffleCardPool(cardPool)
{
    var m = cardPool.deck.length, t, i;

    while (m)
    {
        i = Math.floor(Math.random() * m--);
        t = cardPool.deck[m];
        cardPool.deck[m] = cardPool.deck[i];
        cardPool.deck[i] = t;
    }
}

async function createBoard()
{
    gameMap = document.createElement("div");
    gameMap.setAttribute("id", "gameMap");

    gameMapInner = document.createElement("div");
    gameMapInner.setAttribute("id", "gameMapInner");

    let boardBase = document.createElement("div");
    boardBase.setAttribute("class", "boardBase centerOverlay");
    boardBase.setAttribute("board", "Base");

    // create spaces
    //main board outer ring
    boardBase.appendChild(createSpace("citySpace", "City"));
    boardBase.appendChild(createSpace("fields1Space", "Fields"));
    boardBase.appendChild(createSpace("hills1Space", "Hills"));
    boardBase.appendChild(createSpace("plains1Space", "Plains"));
    boardBase.appendChild(createSpace("woods1Space", "Woods"));
    boardBase.appendChild(createSpace("plains2Space", "Plains"));
    boardBase.appendChild(createSpace("tavernSpace", "Tavern"));
    boardBase.appendChild(createSpace("fields2Space", "Fields"));
    boardBase.appendChild(createSpace("ruinsSpace", "Ruins"));
    boardBase.appendChild(createSpace("plains3Space", "Plains"));
    boardBase.appendChild(createSpace("forest3Space", "Forest"));
    boardBase.appendChild(createSpace("fields3Space", "Fields"));
    boardBase.appendChild(createSpace("villageSpace", "Village"));
    boardBase.appendChild(createSpace("fields4Space", "Fields"));
    boardBase.appendChild(createSpace("graveyardSpace", "Graveyard"));
    boardBase.appendChild(createSpace("woods2Space", "Woods"));
    boardBase.appendChild(createSpace("sentinelSpace", "Sentinel"));
    boardBase.appendChild(createSpace("hills2Space", "Hills"));
    boardBase.appendChild(createSpace("chapelSpace", "Chapel"));
    boardBase.appendChild(createSpace("fields5Space", "Fields"));
    boardBase.appendChild(createSpace("cragsSpace", "Crags"));
    boardBase.appendChild(createSpace("plains4Space", "Plains"));
    boardBase.appendChild(createSpace("woods3Space", "Woods"));
    boardBase.appendChild(createSpace("fields6Space", "Fields"));

    // main board middle ring
    boardBase.appendChild(createSpace("warlocksCaveSpace", "Warlock's Cave"));
    boardBase.appendChild(createSpace("desert1Space", "Desert"));
    boardBase.appendChild(createSpace("oasisSpace", "Oasis"));
    boardBase.appendChild(createSpace("desert2Space", "Desert"));
    boardBase.appendChild(createSpace("templeSpace", "Temple"));
    boardBase.appendChild(createSpace("woodsSpace", "Woods"));
    boardBase.appendChild(createSpace("runes1Space", "Runes"));
    boardBase.appendChild(createSpace("castleSpace", "Castle"));
    boardBase.appendChild(createSpace("portalOfPowerSpace", "Portal of Power"));
    boardBase.appendChild(createSpace("blackKnightSpace", "Black Knight"));
    boardBase.appendChild(createSpace("hiddenValleySpace", "Hidden Valley"));
    boardBase.appendChild(createSpace("hillsSpace", "Hills"));
    boardBase.appendChild(createSpace("cursedGladeSpace", "Cursed Glade"));
    boardBase.appendChild(createSpace("runes2Space", "Runes"));
    boardBase.appendChild(createSpace("chasmSpace", "Chasm"));
    boardBase.appendChild(createSpace("runes3Space", "Runes"));

    //main board inner ring
    boardBase.appendChild(createSpace("valleyOfFireSpace", "Valley of Fire"));
    boardBase.appendChild(createSpace("werewolfDenSpace", "Werewolf Den"));
    boardBase.appendChild(createSpace("deathSpace", "Death"));
    boardBase.appendChild(createSpace("cryptSpace", "Crypt"));
    boardBase.appendChild(createSpace("plainOfPerilSpace", "Plain of Peril"));
    boardBase.appendChild(createSpace("minesSpace", "Mines"));
    boardBase.appendChild(createSpace("vampiresTowerSpace", "Vampire's Tower"));
    boardBase.appendChild(createSpace("pitsSpace", "Pits"));
    boardBase.appendChild(createSpace("crownOfCommandSpace", "Crown of Command"));

    // highland board
    let highlandBoard = document.createElement("div");
    highlandBoard.setAttribute("class", "boardExpansion boardHighland expansionOverlay");
    highlandBoard.setAttribute("board", "Highland");

    highlandBoard.appendChild(createSpace("highlandEntranceSpace", "Highland Entrance"));
    highlandBoard.appendChild(createSpace("highlandHills1Space", "Hills"));
    highlandBoard.appendChild(createSpace("highlandCliff1Space", "Cliff"));
    highlandBoard.appendChild(createSpace("highlandRidgewaySpace", "Ridgeway"));
    highlandBoard.appendChild(createSpace("highlandRavine1Space", "Ravine"));
    highlandBoard.appendChild(createSpace("highlandHills2Space", "Hills"));
    highlandBoard.appendChild(createSpace("highlandRuinedMineSpace", "Ruined Mine"));
    highlandBoard.appendChild(createSpace("highlandCliff2Space", "Cliff"));
    highlandBoard.appendChild(createSpace("highlandRavine2Space", "Ravine"));
    highlandBoard.appendChild(createSpace("highlandHills3Space", "Hills"));
    highlandBoard.appendChild(createSpace("highlandGlacierSpace", "Glacier"));
    highlandBoard.appendChild(createSpace("highlandCliff3Space", "Cliff"));
    highlandBoard.appendChild(createSpace("highlandCanyon1Space", "Canyon"));
    highlandBoard.appendChild(createSpace("highlandMountainPassSpace", "Mountain Pass"));
    highlandBoard.appendChild(createSpace("highlandCliff4Space", "Cliff"));
    highlandBoard.appendChild(createSpace("highlandHills4Space", "Hills"));
    highlandBoard.appendChild(createSpace("highlandPrecipice1Space", "Precipice"));
    highlandBoard.appendChild(createSpace("highlandRavine3Space", "Ravine"));
    highlandBoard.appendChild(createSpace("highlandHills5Space", "Hills"));
    highlandBoard.appendChild(createSpace("highlandCliff5Space", "Cliff"));
    highlandBoard.appendChild(createSpace("highlandWaterfallSpace", "Waterfall"));
    highlandBoard.appendChild(createSpace("highlandCanyon2Space", "Canyon"));
    highlandBoard.appendChild(createSpace("highlandCliff6Space", "Cliff"));
    highlandBoard.appendChild(createSpace("highlandLostCitySpace", "Lost City"));
    highlandBoard.appendChild(createSpace("highlandPrecipice2Space", "Precipice"));
    highlandBoard.appendChild(createSpace("highlandRavine4Space", "Ravine"));
    highlandBoard.appendChild(createSpace("highlandIceBridgeSpace", "Ice Bridge"));
    highlandBoard.appendChild(createSpace("highlandCanyon3Space", "Canyon"));
    highlandBoard.appendChild(createSpace("highlandEyrieSpace", "Eyrie"));

    //city board
    let cityBoard = document.createElement("div");
    cityBoard.setAttribute("class", "boardExpansion boardCity expansionOverlay");
    cityBoard.setAttribute("board", "City");

    cityBoard.appendChild(createSpace("cityGateSpace", "City Gate"));
    cityBoard.appendChild(createSpace("citySquareOfKingsSpace", "Square of Kings"));
    cityBoard.appendChild(createSpace("cityRoyalLaneSpace", "Royal Lane"));
    cityBoard.appendChild(createSpace("citySouthSideAlleySpace", "South Side Alley"));
    cityBoard.appendChild(createSpace("citySanctuarySquareSpace", "Sanctuary Square"));
    cityBoard.appendChild(createSpace("cityHighTempleSpace", "High Temple"));
    cityBoard.appendChild(createSpace("cityNobleStreetSpace", "Noble Street"));
    cityBoard.appendChild(createSpace("cityAcademySpace", "Academy"));
    cityBoard.appendChild(createSpace("cityFlaskStreetSpace", "Flask Street"));
    cityBoard.appendChild(createSpace("cityApothecarySpace", "Apothecary"));
    cityBoard.appendChild(createSpace("cityElementalAvenueSpace", "Elemental Avenue"));
    cityBoard.appendChild(createSpace("citySorcererSquareSpace", "Sorcerer Square"));
    cityBoard.appendChild(createSpace("cityTownSquareSpace", "Town Square"));
    cityBoard.appendChild(createSpace("cityMagicEmporiumSpace", "Magic Emporium"));
    cityBoard.appendChild(createSpace("cityJailSpace", "Jail"));
    cityBoard.appendChild(createSpace("citySoothsayerSpace", "Soothsayer"));
    cityBoard.appendChild(createSpace("cityGuildStreetSpace", "Guild Street"));
    cityBoard.appendChild(createSpace("cityArmourySpace", "Armoury"));
    cityBoard.appendChild(createSpace("cityRatsRoadSpace", "Rat's Road"));
    cityBoard.appendChild(createSpace("cityMenagerieSpace", "Menagerie"));
    cityBoard.appendChild(createSpace("cityDroppingsLaneSpace", "Droppings Lane"));
    cityBoard.appendChild(createSpace("cityStablesSpace", "Stables"));
    cityBoard.appendChild(createSpace("cityBeggarsRowSpace", "Beggar's Row"));
    cityBoard.appendChild(createSpace("cityWharfSpace", "Wharf"));
    cityBoard.appendChild(createSpace("cityThievesAlleySpace", "Thieves' Alley"));
    cityBoard.appendChild(createSpace("cityRoguesGuildSpace", "Rogues' Guild"));
    cityBoard.appendChild(createSpace("cityNorthSideAlleySpace", "North Side Alley"));
    cityBoard.appendChild(createSpace("cityCobbleLaneSpace", "Cobble Lane"));
    cityBoard.appendChild(createSpace("cityGoldStreetSpace", "Gold Street"));
    cityBoard.appendChild(createSpace("citySpeakersCornerSpace", "Speakers Corner"));

    //dungeon board
    let dungeonBoard = document.createElement("div");
    dungeonBoard.setAttribute("class", "boardExpansion boardDungeon expansionOverlay");
    dungeonBoard.setAttribute("board", "Dungeon");

    dungeonBoard.appendChild(createSpace("dungeonEntranceSpace", "Dungeon Entrance"));
    dungeonBoard.appendChild(createSpace("dungeonCorridor1Space", "Corridor"));
    dungeonBoard.appendChild(createSpace("dungeonTunnel1Space", "Tunnel"));
    dungeonBoard.appendChild(createSpace("dungeonLibrarySpace", "Library"));
    dungeonBoard.appendChild(createSpace("dungeonCavern1Space", "Cavern"));
    dungeonBoard.appendChild(createSpace("dungeonCorridor2Space", "Corridor"));
    dungeonBoard.appendChild(createSpace("dungeonGuardRoomSpace", "Guard Room"));
    dungeonBoard.appendChild(createSpace("dungeonTunnel2Space", "Tunnel"));
    dungeonBoard.appendChild(createSpace("dungeonCavern2Space", "Cavern"));
    dungeonBoard.appendChild(createSpace("dungeonCorridor3Space", "Corridor"));
    dungeonBoard.appendChild(createSpace("dungeonCellSpace", "Cell"));
    dungeonBoard.appendChild(createSpace("dungeonTunnel3Space", "Tunnel"));
    dungeonBoard.appendChild(createSpace("dungeonVault1Space", "Vault"));
    dungeonBoard.appendChild(createSpace("dungeonHallOfDarknessSpace", "Hall of Darkness"));
    dungeonBoard.appendChild(createSpace("dungeonTunnel4Space", "Tunnel"));
    dungeonBoard.appendChild(createSpace("dungeonCorridor4Space", "Tunnel"));
    dungeonBoard.appendChild(createSpace("dungeonKitchenSpace", "Kitchen"));
    dungeonBoard.appendChild(createSpace("dungeonCavern3Space", "Cavern"));
    dungeonBoard.appendChild(createSpace("dungeonCorridor5Space", "Corridor"));
    dungeonBoard.appendChild(createSpace("dungeonTunnel5Space", "Tunnel"));
    dungeonBoard.appendChild(createSpace("dungeonTortureChamberSpace", "Torture Chamber"));
    dungeonBoard.appendChild(createSpace("dungeonVault2Space", "Vault"));
    dungeonBoard.appendChild(createSpace("dungeonCorridor6Space", "Corridor"));
    dungeonBoard.appendChild(createSpace("dungeonMonsterPitSpace", "Monster Pit"));
    dungeonBoard.appendChild(createSpace("dungeonTunnel6Space", "Tunnel"));
    dungeonBoard.appendChild(createSpace("dungeonCavern4Space", "Cavern"));
    dungeonBoard.appendChild(createSpace("dungeonSummoningCircleSpace", "Summoning Circle"));
    dungeonBoard.appendChild(createSpace("dungeonVault3Space", "Vault"));
    dungeonBoard.appendChild(createSpace("dungeonTresureChamberSpace", "Treasure Chamber"));

    //woodland board
    let woodlandBoard = document.createElement("div");
    woodlandBoard.setAttribute("class", "boardExpansion boardWoodland expansionOverlay");
    woodlandBoard.setAttribute("board", "Woodland");

    woodlandBoard.appendChild(createSpace("woodlandEntranceSpace", "Woodland Entrance"));
    woodlandBoard.appendChild(createSpace("woodlandWoods1Space", "Woods"));
    woodlandBoard.appendChild(createSpace("woodlandGlade1Space", "Glade"));
    woodlandBoard.appendChild(createSpace("woodlandFaerieRingSpace", "Faerie Ring"));
    woodlandBoard.appendChild(createSpace("woodlandThicket1Space", "Thicket"));
    woodlandBoard.appendChild(createSpace("woodlandWoods2Space", "Woods"));
    woodlandBoard.appendChild(createSpace("woodlandWitchTreeSpace", "Witch Tree"));
    woodlandBoard.appendChild(createSpace("woodlandGlade2Space", "Glade"));
    woodlandBoard.appendChild(createSpace("woodlandThicket2Space", "Thicket"));
    woodlandBoard.appendChild(createSpace("woodlandWoods3Space", "Woods"));
    woodlandBoard.appendChild(createSpace("woodlandCrossroadsSpace", "Crossroads"));
    woodlandBoard.appendChild(createSpace("woodlandGlade3Space", "Glade"));
    woodlandBoard.appendChild(createSpace("woodlandDenseForestSpace", "Dense Forest"));
    woodlandBoard.appendChild(createSpace("woodlandSwamplandSpace", "Swampland"));
    woodlandBoard.appendChild(createSpace("woodlandGlade4Space", "Glade"));
    woodlandBoard.appendChild(createSpace("woodlandWoods4Space", "Woods"));
    woodlandBoard.appendChild(createSpace("woodlandBog1Space", "Bog"));
    woodlandBoard.appendChild(createSpace("woodlandThicket3Space", "Thicket"));
    woodlandBoard.appendChild(createSpace("woodlandFaerieVillage1Space", "Faerie Village"));
    woodlandBoard.appendChild(createSpace("woodlandGlade5Space", "Glade"));
    woodlandBoard.appendChild(createSpace("woodlandBlastedHeathSpace", "Blasted Heath"));
    woodlandBoard.appendChild(createSpace("woodlandDenseForest1Space", "Dense Forest"));
    woodlandBoard.appendChild(createSpace("woodlandFaerieVillage2Space", "Faerie Village"));
    woodlandBoard.appendChild(createSpace("woodlandMysticGlenSpace", "Mystic Glen"));
    woodlandBoard.appendChild(createSpace("woodlandBog2Space", "Bog"));
    woodlandBoard.appendChild(createSpace("woodlandThicket4Space", "Thicket"));
    woodlandBoard.appendChild(createSpace("woodlandMabsLairSpace", "Mab's Lair"));
    woodlandBoard.appendChild(createSpace("woodlandDenseForest2Space", "Dense Forest"));
    woodlandBoard.appendChild(createSpace("woodlandMeetingWithDestinySpace", "Meeting with Destiny"));

    //woodland board
    let boardDeeprealm = document.createElement("div");
    boardDeeprealm.setAttribute("class", "boardDeeprealm expansionOverlay");
    boardDeeprealm.setAttribute("board", "Deeprealm");

    boardDeeprealm.appendChild(createSpace("deeprealmOldSewerSpace", "Old Sewers"));
    boardDeeprealm.appendChild(createSpace("deeprealmRatsNestSpace", "Rat's Nest"));
    boardDeeprealm.appendChild(createSpace("deeprealmThroneRoom", "Throne Room"));
    boardDeeprealm.appendChild(createSpace("deeprealmCatacombsSpace", "Catacombs"));
    boardDeeprealm.appendChild(createSpace("deeprealmRatRunSpace", "Rat Run"));
    boardDeeprealm.appendChild(createSpace("deeprealmSkullPassageSpace", "Skull Passage"));

    //board backgrounds
    let centerBackground = document.createElement("div");
    centerBackground.setAttribute("class", "boardBase centerBackground");

    let highlandBackground = document.createElement("div");
    highlandBackground.setAttribute("class", "boardExpansion boardHighland expansionBackground");

    let cityBackground = document.createElement("div");
    cityBackground.setAttribute("class", "boardExpansion boardCity expansionBackground");

    let woodlandBackground = document.createElement("div");
    woodlandBackground.setAttribute("class", "boardExpansion boardWoodland expansionBackground");

    let dungeonBackground = document.createElement("div");
    dungeonBackground.setAttribute("class", "boardExpansion boardDungeon expansionBackground");

    let deeprealmBackground = document.createElement("div");
    deeprealmBackground.setAttribute("class", "boardDeeprealm expansionBackground");

    gameMapInner.appendChild(centerBackground);
    gameMapInner.appendChild(highlandBackground);
    gameMapInner.appendChild(cityBackground);
    gameMapInner.appendChild(woodlandBackground);
    gameMapInner.appendChild(dungeonBackground);
    gameMapInner.appendChild(deeprealmBackground);

    gameMapInner.appendChild(boardBase);
    gameMapInner.appendChild(woodlandBoard);
    gameMapInner.appendChild(cityBoard);
    gameMapInner.appendChild(dungeonBoard);
    gameMapInner.appendChild(highlandBoard);
    gameMapInner.appendChild(boardDeeprealm);

    //append spaces
    gameMap.appendChild(gameMapInner);

    // deck drawers
    //city deck drawer
    let cityDrawer = document.createElement("div");
    cityDrawer.className = "cityDrawer upperDrawer";

    let cityDeckDrawer = document.createElement("div");
    cityDeckDrawer.className = "deckIcon upperDeck cityDeck";
    cityDeckDrawer.textContent = "City";

    let wantedDeckDrawer = document.createElement("div");
    wantedDeckDrawer.className = "deckIcon upperDeck wantedDeck";
    wantedDeckDrawer.textContent = "Wanted";

    let petsDeckDrawer = document.createElement("div");
    petsDeckDrawer.className = "deckIcon upperDeck petsDeck";
    petsDeckDrawer.textContent = "Pets";

    let armouryDeckDrawer = document.createElement("div");
    armouryDeckDrawer.className = "deckIcon upperDeck armouryDeck";
    armouryDeckDrawer.textContent = "Armoury";

    let potionsDeckDrawer = document.createElement("div");
    potionsDeckDrawer.className = "deckIcon upperDeck potionsDeck";
    potionsDeckDrawer.textContent = "Potions";

    let emporiumDeckDrawer = document.createElement("div");
    emporiumDeckDrawer.className = "deckIcon upperDeck emporiumDeck";
    emporiumDeckDrawer.textContent = "Emporium";

    let stablesDeckDrawer = document.createElement("div");
    stablesDeckDrawer.className = "deckIcon upperDeck stablesDeck";
    stablesDeckDrawer.textContent = "Stables";

    let spellsUpperDeckDrawer = document.createElement("div");
    spellsUpperDeckDrawer.className = "deckIcon upperDeck spellsDeck";
    spellsUpperDeckDrawer.textContent = "Spells";

    cityDrawer.appendChild(cityDeckDrawer);
    cityDrawer.appendChild(wantedDeckDrawer);
    cityDrawer.appendChild(petsDeckDrawer);
    cityDrawer.appendChild(armouryDeckDrawer);
    cityDrawer.appendChild(potionsDeckDrawer);
    cityDrawer.appendChild(emporiumDeckDrawer);
    cityDrawer.appendChild(stablesDeckDrawer);
    cityDrawer.appendChild(spellsUpperDeckDrawer);

    let cityDrawerArrow = document.createElement("div");
    cityDrawerArrow.className = "cityDrawerArrow";

    cityDrawer.appendChild(cityDrawerArrow);
    gameMapInner.appendChild(cityDrawer);

    //dungeon deck drawer
    let dungeonDrawer = document.createElement("div");
    dungeonDrawer.className = "dungeonDrawer upperDrawer";

    let dungeonDeckDrawer = document.createElement("div");
    dungeonDeckDrawer.className = "deckIcon upperDeck dungeonDeck";
    dungeonDeckDrawer.textContent = "Dungeon";

    let treasureDeckDrawer = document.createElement("div");
    treasureDeckDrawer.className = "deckIcon upperDeck treasureDeck";
    treasureDeckDrawer.textContent = "Treasure";

    dungeonDrawer.appendChild(dungeonDeckDrawer);
    dungeonDrawer.appendChild(treasureDeckDrawer);
    dungeonDrawer.appendChild(spellsUpperDeckDrawer);

    let dungeonDrawerArrow = document.createElement("div");
    dungeonDrawerArrow.className = "dungeonDrawerArrow";

    dungeonDrawer.appendChild(dungeonDrawerArrow);
    gameMapInner.appendChild(dungeonDrawer);

    //woodland deck drawer
    let woodlandDrawer = document.createElement("div");
    woodlandDrawer.className = "woodlandDrawer bottomDrawer";

    let woodlandDeckDrawer = document.createElement("div");
    woodlandDeckDrawer.className = "deckIcon lowerDeck woodlandDeck";
    woodlandDeckDrawer.textContent = "Woodland";

    let pathDeckDrawer = document.createElement("div");
    pathDeckDrawer.className = "deckIcon lowerDeck pathDeck";
    pathDeckDrawer.textContent = "Path";

    let destinyDeckDrawer = document.createElement("div");
    destinyDeckDrawer.className = "deckIcon lowerDeck destinyDeck";
    destinyDeckDrawer.textContent = "Destiny";

    let spellsLowerDeckDrawer = document.createElement("div");
    spellsLowerDeckDrawer.className = "deckIcon lowerDeck spellsDeck";
    spellsLowerDeckDrawer.textContent = "Spells";

    woodlandDrawer.appendChild(woodlandDeckDrawer);
    woodlandDrawer.appendChild(pathDeckDrawer);
    woodlandDrawer.appendChild(destinyDeckDrawer);
    woodlandDrawer.appendChild(spellsLowerDeckDrawer);


    let woodlandDrawerArrow = document.createElement("div");
    woodlandDrawerArrow.className = "woodlandDrawerArrow";

    woodlandDrawer.appendChild(woodlandDrawerArrow);
    gameMapInner.appendChild(woodlandDrawer);

    //highland deck drawer
    let highlandDrawer = document.createElement("div");
    highlandDrawer.className = "highlandDrawer bottomDrawer";

    let highlandDrawerArrow = document.createElement("div");
    highlandDrawerArrow.className = "highlandDrawerArrow";

    highlandDrawer.appendChild(highlandDrawerArrow);
    gameMapInner.appendChild(highlandDrawer);

    //characterSheetContainer
    characterSheetContainer = document.createElement("div");
    characterSheetContainer.className = "characterSheetContainer";

    let characterSheetName = document.createElement("div");
    characterSheetName.className = "characterSheetName";
    characterSheetName.textContent = "Schnitzel Master";

    let characterSheetStrength = document.createElement("div");
    characterSheetStrength.className = "characterSheetStrength";
    characterSheetStrength.textContent = "25";

    let characterSheetCraft = document.createElement("div");
    characterSheetCraft.className = "characterSheetCraft";
    characterSheetCraft.textContent = "25";

    let characterSheetFateLight = document.createElement("div");
    characterSheetFateLight.className = "characterSheetFateLight";
    characterSheetFateLight.textContent = "15"

    let characterSheetFateDark = document.createElement("div");
    characterSheetFateDark.className = "characterSheetFateDark";
    characterSheetFateDark.textContent = "15"

    let characterSheetLife = document.createElement("div");
    characterSheetLife.className = "characterSheetLife";
    characterSheetLife.textContent = "25";

    let characterSheetCoin = document.createElement("div");
    characterSheetCoin.className = "characterSheetCoin";
    characterSheetCoin.textContent = "35";

    let charsheetMini = document.createElement("div");
    charsheetMini.className = "charsheetMini";

    let charsheetDescription = document.createElement("div");
    charsheetDescription.className = "charsheetDescription";

    let charsheetObjects = document.createElement("div");
    charsheetObjects.className = "charsheetObjects";
    charsheetObjects.textContent = "Objects";

    let charsheetFollowers = document.createElement("div");
    charsheetFollowers.className = "charsheetFollowers";
    charsheetFollowers.textContent = "Followers";

    characterSheetContainer.appendChild(characterSheetName);
    characterSheetContainer.appendChild(characterSheetStrength);
    characterSheetContainer.appendChild(characterSheetCraft);
    characterSheetContainer.appendChild(characterSheetLife);
    characterSheetContainer.appendChild(characterSheetFateLight);
    characterSheetContainer.appendChild(characterSheetFateDark);
    characterSheetContainer.appendChild(characterSheetCoin);
    characterSheetContainer.appendChild(charsheetMini);
    characterSheetContainer.appendChild(charsheetDescription);
    characterSheetContainer.appendChild(charsheetObjects);
    characterSheetContainer.appendChild(charsheetFollowers);
    gameMapInner.appendChild(characterSheetContainer);


    // append game map events
    gameMap.addEventListener("mousedown", function(event)
    {
        dragging = true;
        gameMapInner.style.setProperty("cursor", "grabbing");
        gameMap.addEventListener("mousemove", translateMap);

        let roundedAngle = Math.round(transform.rotate/30)*30;
        if ((roundedAngle == 0 || roundedAngle == 90 || roundedAngle == 180
            || roundedAngle == 270  || roundedAngle == 360))
            transform.rotate = roundedAngle;
    });

    gameMap.addEventListener("mouseup", function(event)
    {
        dragging = false;
        gameMapInner.style.setProperty("cursor", "grab");

        if (spaceClickDisabled)
            setTimeout(function(){ spaceClickDisabled = false; }, 100);
    });

    //append map to game container
    let gameContainer = document.querySelector("#gameContainer");
    gameContainer.appendChild(gameMap);

    //space highlight event
    document.querySelectorAll(".space").forEach(function(space)
    {
        space.addEventListener("click", spaceClick);

        space.addEventListener("mouseenter", function(event)
        {
            //HANDLE HIGHLIGHT FADING
            let target = event.target;
            let fadeID = target.getAttribute("fading");

            if (fadeID)
            {
                clearTimeout(parseInt(fadeID));
                removeMouseHoverElements(target);
            }

            // HIGHLIGHT
            let highlight = document.createElement("div");
            highlight.className = "highlight";

            let tl = document.createElement("div");
            tl.className = "topLeftHighlight";

            let t = document.createElement("div");
            t.className = "topHighlight";

            let tr = document.createElement("div");
            tr.className = "topRightHighlight";

            let r = document.createElement("div");
            r.className = "rightHighlight";

            let br = document.createElement("div");
            br.className = "bottomRightHighlight";

            let b = document.createElement("div");
            b.className = "bottomHighlight";

            let bl = document.createElement("div");
            bl.className = "bottomLeftHighlight";

            let l = document.createElement("div");
            l.className = "leftHighlight";

            highlight.appendChild(tl);
            highlight.appendChild(t);
            highlight.appendChild(tr);
            highlight.appendChild(t);
            highlight.appendChild(br);
            highlight.appendChild(r);
            highlight.appendChild(b);
            highlight.appendChild(bl);
            highlight.appendChild(l);

            target.appendChild(highlight);

            // SPACE DESCRIPTION
            let descriptionContainer = document.createElement("div");
            descriptionContainer.className = "spaceDescriptionContainer";

            //set position
            let computed = window.getComputedStyle(target);
            let spaceWidth = parseInt(computed.width.replace("px", ""));
            let maxContainerWidth = 800;
            let minContainerWidth = 800;
            let nameContainerWidth;

            //set description size
            if(transform.rotate > 135 && transform.rotate < 225)
                descriptionContainer.style.setProperty("top", "0px");
            else
                descriptionContainer.style.setProperty("top", computed.height);
            if (spaceWidth > maxContainerWidth)
            {
                descriptionContainer.style.setProperty("left", ((spaceWidth - maxContainerWidth) * 0.5) + "px");
                nameContainerWidth = spaceWidth - (spaceWidth - maxContainerWidth);
            }
            else if (spaceWidth < minContainerWidth)
            {
                descriptionContainer.style.setProperty("left", ((spaceWidth - minContainerWidth) * 0.5) + "px");
                nameContainerWidth = spaceWidth - (spaceWidth - minContainerWidth);
            }
            else
            {
                descriptionContainer.style.setProperty("left", (spaceWidth * 0.1) + "px");
                nameContainerWidth = spaceWidth * 0.8;
            }

            descriptionContainer.style.setProperty("width", (spaceWidth * 0.8) + "px");
            descriptionContainer.style.setProperty("transform", "rotate(" + (transform.rotate * - 1) + "deg)");

            //space name
            let spaceNameElement = document.createElement("div")
            spaceNameElement.className = "spaceName";

            let maxNameWidth = 540;
            if (nameContainerWidth > maxNameWidth)
                spaceNameElement.style.setProperty("left", ((nameContainerWidth - maxNameWidth) * 0.5) + "px");
            else
                spaceNameElement.style.setProperty("left", "0px");

            let spaceName = target.getAttribute("space")
            spaceNameElement.textContent = spaceName;
            let spaceBoard = target.parentNode.getAttribute("Board");

            //space description
            let spaceDescription = document.createElement("div");
            spaceDescription.className = "spaceDescription";
            createSpaceDescription(spaceDescription, spaceBoard, spaceName);

            descriptionContainer.appendChild(spaceNameElement);
            descriptionContainer.appendChild(spaceDescription);
            target.appendChild(descriptionContainer);
        });

        space.addEventListener("mouseleave", function(event)
        {
            let timeoutID = setTimeout(removeMouseHoverElements, 300, event.target);
            event.target.setAttribute("fading", timeoutID.toString());
        });

    });

    chars = await fetch("assets/text/chars.json", "json");
    console.log(chars);

    cards = await fetch("assets/text/cards.json", "json");
    console.log(cards);

    spaces = await fetch("assets/text/base_spaces.json", "json");
    console.log(spaces);

    charsheetDescription.innerHTML = chars["The Highland"].Alchemist.description;

    //TODO cache json files


    //TODO include/exclude expansions
    //prepare decks
    Object.keys(cards).forEach(function(expansion)
    {
        let expansionObj = cards[expansion];

        Object.keys(expansionObj).forEach(function(deckType)
        {
            let lowercaseDeckType = deckType.toLowerCase();
            if (!(lowercaseDeckType in cardPool))
                cardPool[lowercaseDeckType] = {"deck": [], "discard":[]};

            let cardList = expansionObj[deckType];
            Object.keys(cardList).forEach(function(cardName)
            {
                let cardObj = cardList[cardName];

                for (let i = 0; i < cardObj.count; i++)
                {
                    let card = {"expansion": expansion, "name": cardObj.name};
                    cardPool[lowercaseDeckType].deck.push(card);
                }
            });
        });
    });

    //shuffle decks
    Object.keys(cardPool).forEach(function(deck)
    {
        shuffleCardPool(cardPool[deck]);
    });

    //TODO
    //create deck ui
    //put decks in drawers

    //space context menu
        //draws card from proper deck
        //move character to space
        //display space card pool
        //
    //card context menu
        //discard
        //put on top
        //put on bottom
        //give to
        //take trophy
        //take object
        //take follower
        //take spell
        //place card on space
    //card pool context menu
        //draw card
        //browse cards
        //find card
        //shuffle



    //COMPUTE
    computedStyle = window.getComputedStyle(gameMapInner);
    innerWidth = parseInt(window.getComputedStyle(gameMapInner).width.replace("px", ""));
    innerHeight = parseInt(window.getComputedStyle(gameMapInner).height.replace("px", ""));
    transform = {translate: [innerWidth*-0.35, innerHeight*-0.37], scale: 0.4, rotate: 0}

    setTransform();


}

async function ass()
{
    //connect db
    await storageInit("Talisman", ["boardAssets", "minisAssets", "uiAssets", "tokensAssets"]);
    await storageConnect("Talisman");

    createBoard();

    //main board
    let bbReq = {store: "boardAssets", name: "boardBase", dbName: "Talisman"};
    if (!await storageExists(bbReq)) //cache
    {
        bbReq.data = await fetch("assets/board/base.png", "blob");
        let bbRes = await storagePut(bbReq);
    }

    //load
    let bbRes = await storageGet(bbReq);
    var URL = window.URL || window.webkitURL;
    var bbIMGURL = URL.createObjectURL(bbRes);
    var bbElement = document.querySelector(".boardBase.centerBackground");
    bbElement.style.setProperty("background-image", "url(" + bbIMGURL + ")");

    //highland
    let bhReq = {store: "boardAssets", name: "boardHighland", dbName: "Talisman"};
    if (!await storageExists(bhReq)) //cache
    {
        bhReq.data = await fetch("assets/board/highland.png", "blob");
        let bhRes = await storagePut(bhReq);
    }

    //load
    let bhRes = await storageGet(bhReq);
    var bhIMGURL = URL.createObjectURL(bhRes);
    var bhElement = document.querySelector(".boardExpansion.boardHighland.expansionBackground");
    bhElement.style.setProperty("background-image", "url(" + bhIMGURL + ")");


    //city
    let bcReq = {dbName: "Talisman", store: "boardAssets", name: "boardCity"};
    if (!await storageExists(bcReq))
    {
        bcReq.data = await fetch("assets/board/city.png", "blob");
        let bcRes = await storagePut(bcReq);
    }

    //load
    bcRes = await storageGet(bcReq);
    var bcIMGURL = URL.createObjectURL(bcRes);
    var bcElement = document.querySelector(".boardExpansion.boardCity.expansionBackground");
    bcElement.style.setProperty("background-image", "url(" + bcIMGURL + ")");

    //woodlands
    let bwReq = {dbName: "Talisman", store: "boardAssets", name: "boardWoodlands"};
    if (!await storageExists(bwReq))
    {
        bwReq.data = await fetch("assets/board/woodland.png", "blob");
        let bwRes = await storagePut(bwReq);
    }

    //load
    bwRes = await storageGet(bwReq);
    var bwIMGURL = URL.createObjectURL(bwRes);
    var bwElement = document.querySelector(".boardExpansion.boardWoodland.expansionBackground");
    bwElement.style.setProperty("background-image", "url(" + bwIMGURL + ")");

    //dungeon
    let bdReq = {dbName: "Talisman", store: "boardAssets", name: "boardDungeon"};
    if (!await storageExists(bdReq))
    {
        bdReq.data = await fetch("assets/board/dungeon.png", "blob");
        let bdRes = await storagePut(bdReq);
    }

    //load
    let bdRes = await storageGet(bdReq);
    var bdIMGURL = URL.createObjectURL(bdRes);
    var bdElement = document.querySelector(".boardExpansion.boardDungeon.expansionBackground");
    bdElement.style.setProperty("background-image", "url(" + bdIMGURL + ")");


    //deeprealm
    let bdrReq = {dbName: "Talisman", store: "boardAssets", name: "boardDeeprealm"};
    if (!await storageExists(bdrReq))
    {
        bdrReq.data = await fetch("assets/board/deeprealm.png", "blob");
        let bdrRes = await storagePut(bdrReq);
    }

    //load
    let bdrRes = await storageGet(bdrReq);
    var bdrIMGURL = URL.createObjectURL(bdrRes);
    var bdrElement = document.querySelector(".boardDeeprealm.expansionBackground");
    bdrElement.style.setProperty("background-image", "url(" + bdrIMGURL + ")");


    // //TODO: precache highlight alphas
    //
    // let charCard = await fetch(window.location.origin + "/assets/chars/char_card.png", "blob");
    // let charCardReq = {db: "Talisman", store: "charAssets", data: charCard, name: "charCard"};
    // console.log(await storageExists(charCardReq));
    //
    // let charCardRes = await storagePut(charCardReq);
    // charCardRes = await storageGet(charCardReq);
    //
    // var charCardIMGURL = URL.createObjectURL(charCardRes);
    // var charCardElement = document.querySelector(".charCard");
    // charCardElement.style.setProperty("background-image", "url(" + charCardIMGURL + ")");

    //TODO: auto db update and store create on put

    //removes image on opera
    // URL.revokeObjectURL(imgURL);


}

// ass();
let player = {name: "testboi", id:"123456789"};
let currentGameLobby;
let savedGames = [];
let openGames = [];
let gameDetails =
{
    "asdfghjkl123456789":
    {
        id: "asdfghjkl123456789",
        owner: {name: "testboi", id:"123456789"},
        playerCount: 5,
        status: "load",
        turn: 25,
        players: [{name: "testboi", id:"123456789", char: ""},
                {name: "putin", id: "6661", char: "Assassin"},
                {name: "trump", id: "6662", char: "Troll"},
                {name: "xijingping", id: "6663", char: "Dark Cultist"},
                {name: "kimjongun", id: "6664", char: "Barbarian"}],
        rules:
        {
            expansions: ["The Ancient Beasts", "The Blood Moon", "The City",
                        "The Deep Realm", "The Sacred Pool"],
            characters: ["The Ancient Beasts", "The Blood Moon", "The Cataclysm",
                        "The City", "The Clockwork Kingdom", "The Deep Realm",
                        "The Dragon", "The Dungeon", "The Firelands", "The Forstmarch",
                        "The Harbinger", "The Highland", "The Nether Realm", "The Realm of Souls",
                        "The Reaper", "The Sacred Pool", "The Woodland"]
        }
    },
    "987654321lkjhgfdsa":
    {
        id: "987654321lkjhgfdsa",
        owner: {name: "testboi", id:"123456789"},
        playerCount: 4,
        status: "fresh",
        turn: 0,
        players: [{name: "testboi", id:"123456789", char: ""},
                {name: "putin", id: "6661", char: "Conman"},
                {name: "trump", id: "6662", char: "Leprechaun"},
                {name: "kimjongun", id: "6664", char: "Grave Robber"}],
        rules : {expansions : [], characters : []}
    }
}

function fetchSavedGames()
{
    let game =
    {
        id: "asdfghjkl123456789",
        owner: {name: "testboi", id:"123456789"},
        playerCount: 5,
        slots: 6,
        status: "load",
        turn: 25
    }

    savedGames.push(game);
}

function fetchOpenGames()
{
    let game =
    {
        id: "987654321lkjhgfdsa",
        owner: {name: "testboi", id:"123456789"},
        playerCount: 4,
        slots: 6,
        status: "fresh",
        turn: 0
    };
    openGames.push(game);
}

// PARSE GAME OBJECT TO ELEMENT
function parseGame(game, type)
{
    let element = document.createElement("div");
    element.className = type + "Game";
    element.setAttribute("gameid", game.id);

    let gameTypeElement = document.createElement("div");
    gameTypeElement.className = "gameTypeIcon";
    gameTypeElement.textContent = (game.status == "fresh") ? "✿" : "♻";

    let ownerElement = document.createElement("div");
    ownerElement.className = "gameOwner";
    ownerElement.textContent = game.owner.name + "'s game";

    let slotsElement = document.createElement("div");
    slotsElement.className = "gameSlots";
    slotsElement.textContent = game.playerCount + " / " + game.slots + " players";

    let statusElement = document.createElement("div");
    statusElement.className = "gameStatus";
    statusElement.textContent = (game.status == "fresh") ? "Not started yet" : (game.turn + " turn load");

    element.addEventListener("click", loadLobby);

    element.appendChild(gameTypeElement);
    element.appendChild(ownerElement);
    element.appendChild(slotsElement);
    element.appendChild(statusElement);

    return element;
}

// FETCH AVAILABLE GAMES
async function fetchGames()
{
    fetchSavedGames();
    fetchOpenGames();

    let gameListElement = document.querySelector(".gameList");

    //draw saved games
    savedGames.forEach(function(game)
    {
        gameListElement.appendChild(parseGame(game, "load"));
    });

    //draw open games
    openGames.forEach(function(game)
    {
        gameListElement.appendChild(parseGame(game, "open"));
    });
}

function selectCharacter(name)
{
    //select char
    let slotID;
    for (var i = 0, l = currentGameLobby.players.length; i < l; i++)
    {
        let lobbyPlayer = currentGameLobby.players[i];
        if (lobbyPlayer.name == player.name)
        {
            lobbyPlayer.char = name;
            slotID = i;
        }
    }

    let slot = document.querySelector(".gameSlot:nth-child(" + slotID + 1  + ")");
    slot.querySelector(".slotCharPic").style.setProperty("background-image", "url(assets/chars/" + ((name != "Random") ? charsSorted[name].filePrefix : "random") + "_picture.png)");
    slot.querySelector(".slotCharName").textContent = name;


    let selector = document.querySelector(".characterSelector");
    selector.parentNode.removeChild(selector);
    //close character selector
}

function selectCharacterEvent(event)
{
    selectCharacter(event.target.getAttribute("name"));
}

function searchCharacterName(event)
{
    if (event.keyCode === 13)
    {
        let chars = document.querySelectorAll(".charSelectorCharContainer");

        chars.forEach(function(char)
        {
            if (char.style.getPropertyValue("display") == "inline-block")
                selectCharacter(char.getAttribute("name"));

        });

        event.preventDefault();
        return;
    }

    document.querySelectorAll(".charSelectorCharContainer").forEach(function(mini)
    {
        if (mini.getAttribute("name").toLowerCase().search(event.target.value.toLowerCase()) > -1)
        {
            mini.style.setProperty("opacity", "1");
            mini.style.setProperty("display", "inline-block");
        }
        else
        {
            mini.style.setProperty("opacity", 0);
            setTimeout(function(mini){ mini.style.setProperty("display", "none"); }, 200, mini);
        }
    });
}

let charsSorted = {};
//sort chars
function sortCharacters()
{
    let charsTemp = {};
    for (let expansionName in chars)
    {
        let expansion = chars[expansionName];

        for (let charName in expansion)
        {
            charsTemp[charName] = expansion[charName];
        }
    }
    charsSorted = {};
    Object.keys(charsTemp).sort().forEach(function(key) { charsSorted[key] = charsTemp[key]; });
}

function displayCharacterDescription(event)
{
    let description = document.querySelector(".characterSelectorDescription");
    description.style.setProperty("display", "block");
    description.innerHTML = charsSorted[event.target.getAttribute("name")].description;
}

function removeCharacterDescription(event)
{
    let description = document.querySelector(".characterSelectorDescription");
    description.style.setProperty("display", "none");
}

let charStatLookupTable = {strength: {}, craft: {}, fate: {}, life: {}};
function openCharacterSelector()
{
    let characterSelector = document.createElement("div");
    characterSelector.className = "characterSelector";

    //character name search input field
    let nameSearchLabel = document.createElement("div");
    nameSearchLabel.className = "nameSearchLabel";
    nameSearchLabel.textContent = "Search character name:";

    let nameSearchInput = document.createElement("input");
    nameSearchInput.className = "nameSearchInput";
    nameSearchInput.type = "text";
    nameSearchInput.addEventListener("keyup", searchCharacterName);

    let characterPicker = document.createElement("div");
    characterPicker.className = "characterPicker";

    //character picker scroll
    characterPicker.addEventListener("mousewheel", function(event)
    {
        characterPicker.scrollLeft += event.deltaY;
        event.preventDefault();
    });

    //create random character icon
    let randomContainer = document.createElement("div");
    randomContainer.className = "charSelectorCharContainer";

    let randomName = document.createElement("div");
    randomName.className = "characterSelectorName";
    randomName.textContent = "Random";

    randomContainer.style.backgroundImage = "url(assets/chars/random_card.png)";
    randomContainer.setAttribute("name", "Random");

    randomContainer.addEventListener("click", selectCharacterEvent);

    randomContainer.appendChild(randomName);
    characterPicker.appendChild(randomContainer);

    //create character icons
    for (let charName in charsSorted)
    {
        let character = charsSorted[charName];
        let charContainer = document.createElement("div");
        charContainer.className = "charSelectorCharContainer";

        let characterName = document.createElement("div");
        characterName.className = "characterSelectorName";
        characterName.textContent = charName;

        charContainer.style.backgroundImage = "url(assets/chars/" + character.filePrefix + "_miniature.png)";
        charContainer.setAttribute("name", charName);

        charContainer.addEventListener("click", selectCharacterEvent);
        charContainer.addEventListener("mouseover", displayCharacterDescription);
        charContainer.addEventListener("mouseout", removeCharacterDescription);

        charContainer.appendChild(characterName);
        characterPicker.appendChild(charContainer);
    }

    //character description
    let charDescription = document.createElement("div");
    charDescription.className = "characterSelectorDescription";

    //character stats filter
    //prepare lookup table
    for (let charName in charsSorted)
    {
        let char = charsSorted[charName];

        if (!charStatLookupTable.strength[char.strength])
            charStatLookupTable.strength[char.strength] = [];
        if (!charStatLookupTable.craft[char.craft])
            charStatLookupTable.craft[char.craft] = [];
        if (!charStatLookupTable.fate[char.fate])
            charStatLookupTable.fate[char.fate] = [];
        if (!charStatLookupTable.life[char.life])
            charStatLookupTable.life[char.life] = [];


        charStatLookupTable.strength[char.strength].push(char);
        charStatLookupTable.craft[char.craft].push(char);
        charStatLookupTable.fate[char.fate].push(char);
        charStatLookupTable.life[char.life].push(char);
    };
    console.log(charStatLookupTable);

    //append all that shit
    characterSelector.appendChild(nameSearchLabel);
    characterSelector.appendChild(nameSearchInput);
    characterSelector.appendChild(characterPicker);
    characterSelector.appendChild(charDescription);

    document.body.appendChild(characterSelector);
}

let readyPlayers = [];
function togglePlayerReady(event)
{
    let playerName = event.target.parentNode.querySelector(".slotPlayerName").textContent;

    if (player.name != playerName)
        return;

    if (!readyPlayers.includes(playerName))
    {
        readyPlayers.push(playerName);
        event.target.style.setProperty("background-image", "url(assets/ui/ready_icon.png)");
    }
    else
    {
        readyPlayers = readyPlayers.filter(function(e) { return e !== playerName });
        event.target.style.setProperty("background-image", "url(assets/ui/ready_button.png)");
    }
}

// set lobby slot display
function setLobbySlot(game, slotID)
{
    let gameSlot = document.createElement("div");
    gameSlot.className = "gameSlot";

    let playerName = document.createElement("div");
    playerName.className = "slotPlayerName";

    let slotPlayer = game.players[slotID];

    playerName.textContent = slotPlayer ? slotPlayer.name : "";

    let charPic = document.createElement("div");
    charPic.className = "slotCharPic";
    charPic.style.setProperty("background-image", "url(" + ((slotPlayer.char.length > 0) ? "assets/chars/" + charsSorted[slotPlayer.char].filePrefix : "assets/chars/random") + "_picture.png)");

    let charName = document.createElement("div");
    charName.className = "slotCharName";
    charName.textContent = (slotPlayer.char.length > 0) ? slotPlayer.char : "Random";

    let readyButton = document.createElement("div");
    readyButton.className = "readyButton";
    readyButton.style.setProperty("background-image", "url(assets/ui/ready_button.png)");

    readyButton.addEventListener("click", togglePlayerReady);

    if (player.id == slotPlayer.id)
    {
        charPic.classList.add("clickable");
        charPic.addEventListener("click", openCharacterSelector);
        readyButton.style.setProperty("cursor", "pointer");
    }

    //slot remove element

    gameSlot.appendChild(playerName);
    gameSlot.appendChild(charPic);
    gameSlot.appendChild(charName);
    gameSlot.appendChild(readyButton);

    return gameSlot;
}

function leaveLobby()
{
    currentGameLobby = {};
    readyPlayers = [];
    let lobby = document.querySelector(".gameLobby");
    lobby.parentNode.removeChild(lobby);
    loadGameList();
}

function loadLobby(event)
{
    //empty game list containers
    savedGames = [];
    openGames = [];

    sortCharacters();
    //TODO
    //game expansions selection

    let gameLobby = document.createElement("div");
    gameLobby.className = "gameLobby";

    let gameSlotsContainer = document.createElement("div");
    gameSlotsContainer.className = "gameSlotsContainer";

    //get game details

    currentGameLobby = gameDetails[event.target.getAttribute("gameid")];

    for (var i = 0; i < currentGameLobby.playerCount; i++)
    {
        gameSlotsContainer.appendChild(setLobbySlot(currentGameLobby, i));
    }

    let meOut = document.createElement("div");
    meOut.className = "letMeOutButton";
    meOut.textContent = "Let me out!";
    meOut.addEventListener("click", leaveLobby);

    gameSlotsContainer.appendChild(meOut);
    gameLobby.appendChild(gameSlotsContainer);
    document.querySelector("#gameContainer").appendChild(gameLobby);

    let gameList = document.querySelector(".gameList");
    gameList.parentNode.removeChild(gameList);

    //sync host state
}

function loadGameList()
{
    let gameList = document.createElement("div");
    gameList.className = "gameList";

    document.querySelector(".mainMenu").appendChild(gameList);
    fetchGames();
}

async function mainMenu()
{
    let mainMenu = document.createElement("div");
    mainMenu.className = "mainMenu";

    let logo = document.createElement("div");
    logo.className = "logo";

    mainMenu.appendChild(logo);

    document.querySelector("#gameContainer").appendChild(mainMenu);

    loadGameList();
}

ass();

/*
TODO
base cards
adventure, spells, purchase, talisman

city cards
city, wanted, pets, armoury, potions, emporium, stables

dungeon cards
dungeon, treasure, spells

highland
highland, relic, spells

woodland
woodland, path, destiny, spells

deeprealm
bridge, tunnel

cataclysm
adventure, denizen, purchase, remnant, spells, talisman, terrain, warlock
*/

// mainMenu();
/*
login
display open games
create game
    select expansion characters
    select expansion cards/board
    game password
    remove player from the game
join selected game
select character
load board
    shuffle cards
    place decks
    place characters
character setup round
    draw spells
    pick items
    assign fate

game
    turn order
    turn counter
    roll
        add/substract points
        dice
            roll movement
            roll against space
            roll against card
            roll against monster
            roll against event
    give to player
        possession
            item
            trophy
            follower
            token
            spell
    move character to space
    draw card from top
    select particular hard
    browse x
        take from browsed group
        discard from browsed group
        place on top
        place on bottom
    show cards on space
    select inner board alternatives
        dragon realm
        dragon tower
*/
</script>
</html>
